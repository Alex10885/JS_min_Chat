fcc0cb7e6d57cf50a1c7fd04efc42320
const mongoose = require('mongoose');
const winston = require('winston');
const {
  performance,
  PerformanceObserver
} = require('perf_hooks');
const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(winston.format.timestamp(), winston.format.errors({
    stack: true
  }), winston.format.json()),
  defaultMeta: {
    service: 'database'
  },
  transports: [new winston.transports.File({
    filename: 'logs/database.log'
  }), new winston.transports.Console({
    format: winston.format.combine(winston.format.colorize(), winston.format.simple())
  })]
});

// Connection pool metrics
let connectionMetrics = {
  activeCount: 0,
  inUseCount: 0,
  availableCount: 0,
  createdCount: 0,
  closedCount: 0,
  pendingCount: 0,
  lastHealthCheck: null,
  connectionLifetime: 0,
  averageQueryTime: 0,
  queriesPerSecond: 0
};
class ConnectionPoolMonitor {
  constructor() {
    this.metrics = connectionMetrics;
    this.healthCheckInterval = null;
    this.performanceObserver = new PerformanceObserver(list => {
      const entries = list.getEntries();
      entries.forEach(entry => {
        if (entry.name === 'mongodb-query') {
          this.updateQueryMetrics(entry.duration);
        }
      });
    });
    this.performanceObserver.observe({
      type: 'measure'
    });
  }
  startHealthChecks(intervalMs = 30000) {
    this.healthCheckInterval = setInterval(() => {
      this.performHealthCheck();
    }, intervalMs);
    logger.info('Connection pool health checks started');
  }
  stopHealthChecks() {
    if (this.healthCheckInterval) {
      clearInterval(this.healthCheckInterval);
      this.healthCheckInterval = null;
      logger.info('Connection pool health checks stopped');
    }
  }
  performHealthCheck() {
    try {
      const stats = mongoose.connection.db.stats();
      this.metrics.lastHealthCheck = new Date();
      logger.info('Connection pool health check passed', {
        activeConnections: this.metrics.activeCount,
        availableConnections: this.metrics.availableCount,
        pendingOperations: this.metrics.pendingCount
      });
    } catch (error) {
      logger.error('Connection pool health check failed:', error);
    }
  }
  updateQueryMetrics(duration) {
    this.metrics.averageQueryTime = (this.metrics.averageQueryTime + duration) / 2;
    this.metrics.queriesPerSecond = 1000 / duration; // approximate
  }
  updatePoolMetrics() {
    if (mongoose.connection.readyState === 1) {
      try {
        const poolSize = mongoose.connection.db.serverConfig.poolSize || 0;
        this.metrics.activeCount = poolSize;
        this.metrics.availableCount = Math.max(0, 20 - this.metrics.inUseCount); // assuming maxPoolSize = 20
        logger.debug('Pool metrics updated', this.metrics);
      } catch (error) {
        logger.warn('Failed to get pool metrics:', error.message);
      }
    }
  }
  getMetrics() {
    this.updatePoolMetrics();
    return {
      ...this.metrics
    };
  }
}

// Initialize connection monitor
const connectionMonitor = new ConnectionPoolMonitor();
const connectDB = async (retries = 5) => {
  for (let i = 1; i <= retries; i++) {
    try {
      const startTime = performance.now();
      const conn = await mongoose.connect(process.env.MONGODB_URI, {
        maxPoolSize: 20,
        // Maximum 20 connections in the pool
        minPoolSize: 5,
        // Maintain minimum 5 connections
        maxIdleTimeMS: 30000,
        // Close connections after 30s of inactivity
        serverSelectionTimeoutMS: 30000,
        socketTimeoutMS: 45000,
        connectTimeoutMS: 30000,
        heartbeatFrequencyMS: 10000,
        // Check health every 10 seconds
        bufferMaxEntries: 0,
        // Disable mongoose buffering
        bufferCommands: false // Disable mongoose buffering
      });
      const connectTime = performance.now() - startTime;
      connectionMonitor.metrics.connectionLifetime = connectTime;
      logger.info(`MongoDB Connected: ${conn.connection.host} (${connectTime.toFixed(2)}ms)`);

      // Start connection monitoring
      connectionMonitor.startHealthChecks();

      // Handle connection events with enhanced tracking
      mongoose.connection.on('connectionCreated', data => {
        connectionMonitor.metrics.createdCount++;
        connectionMonitor.metrics.activeCount++;
        logger.info('Connection created', {
          totalCreated: connectionMonitor.metrics.createdCount,
          activeCount: connectionMonitor.metrics.activeCount
        });
      });
      mongoose.connection.on('connectionClosed', data => {
        connectionMonitor.metrics.closedCount++;
        connectionMonitor.metrics.activeCount = Math.max(0, connectionMonitor.metrics.activeCount - 1);
        logger.info('Connection closed', {
          totalClosed: connectionMonitor.metrics.closedCount,
          activeCount: connectionMonitor.metrics.activeCount
        });
      });
      mongoose.connection.on('connectionReady', data => {
        logger.debug('Connection ready for use');
      });
      mongoose.connection.on('connectionLeased', data => {
        connectionMonitor.metrics.inUseCount++;
        logger.debug(`Connection leased - In use: ${connectionMonitor.metrics.inUseCount}`);
      });
      mongoose.connection.on('connectionReturned', data => {
        connectionMonitor.metrics.inUseCount = Math.max(0, connectionMonitor.metrics.inUseCount - 1);
        logger.debug(`Connection returned - Available: ${connectionMonitor.metrics.availableCount}`);
      });
      mongoose.connection.on('error', err => {
        logger.error('Database connection error:', err);
      });
      mongoose.connection.on('disconnected', () => {
        connectionMonitor.stopHealthChecks();
        logger.warn('Database disconnected');

        // Enhanced reconnection strategy with exponential backoff
        setTimeout(() => {
          logger.info('Attempting automated reconnection...');
          connectDB(3); // 3 retries on disconnection
        }, 5000);
      });
      mongoose.connection.on('reconnected', () => {
        logger.info('Database reconnected successfully');
        connectionMonitor.startHealthChecks(); // Restart health checks
      });
      mongoose.connection.on('reconnectFailed', err => {
        logger.error('Database reconnection failed:', err);
      });

      // Periodic pool status logging
      setInterval(() => {
        const metrics = connectionMonitor.getMetrics();
        logger.info('Connection Pool Status', {
          active: metrics.activeCount,
          inUse: metrics.inUseCount,
          available: metrics.availableCount,
          pending: metrics.pendingCount,
          averageQueryTime: `${metrics.averageQueryTime.toFixed(2)}ms`,
          queriesPerSecond: metrics.queriesPerSecond.toFixed(2)
        });
      }, 60000); // Log every minute

      return conn;
    } catch (error) {
      logger.error(`Database connection attempt ${i}/${retries} failed:`, error);
      if (i === retries) {
        logger.error('Database connection failed after all retries:', error);
        throw error; // Let the caller handle it
      }

      // Exponential backoff for retries
      const delay = Math.min(1000 * Math.pow(2, i - 1), 30000);
      logger.info(`Retrying database connection in ${delay}ms...`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
};
const closeDB = async () => {
  try {
    // Stop health checks before closing
    connectionMonitor.stopHealthChecks();
    if (mongoose.connection.readyState === 1) {
      await mongoose.connection.close();
      logger.info('Database connection closed gracefully');
      logger.info('Final connection metrics:', connectionMonitor.getMetrics());
    } else {
      logger.info('Database connection was not open, no need to close');
    }
  } catch (error) {
    logger.error('Error closing database connection:', error);
    // Force close if graceful close fails
    try {
      mongoose.connection.close(true);
      logger.warn('Database connection force closed');
    } catch (forceError) {
      logger.error('Force close failed:', forceError);
    }
  }
};

// Utility function to get connection status
const getConnectionStatus = () => {
  return {
    isConnected: mongoose.connection.readyState === 1,
    readyState: mongoose.connection.readyState,
    host: mongoose.connection.host || null,
    database: mongoose.connection.name || null,
    metrics: connectionMonitor.getMetrics()
  };
};

// Middleware function to track query performance (can be used in routes)
const trackQueryPerformance = queryName => {
  return async next => {
    const start = performance.mark(`${queryName}-start`);
    try {
      const result = await next();
      const end = performance.mark(`${queryName}-end`);
      performance.measure(`${queryName}-duration`, `${queryName}-start`, `${queryName}-end`);
      return result;
    } catch (error) {
      performance.clearMarks(`${queryName}-start`);
      performance.clearMarks(`${queryName}-end`);
      throw error;
    }
  };
};
module.exports = {
  connectDB,
  closeDB,
  getConnectionStatus,
  trackQueryPerformance,
  connectionMonitor
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJ3aW5zdG9uIiwicGVyZm9ybWFuY2UiLCJQZXJmb3JtYW5jZU9ic2VydmVyIiwibG9nZ2VyIiwiY3JlYXRlTG9nZ2VyIiwibGV2ZWwiLCJmb3JtYXQiLCJjb21iaW5lIiwidGltZXN0YW1wIiwiZXJyb3JzIiwic3RhY2siLCJqc29uIiwiZGVmYXVsdE1ldGEiLCJzZXJ2aWNlIiwidHJhbnNwb3J0cyIsIkZpbGUiLCJmaWxlbmFtZSIsIkNvbnNvbGUiLCJjb2xvcml6ZSIsInNpbXBsZSIsImNvbm5lY3Rpb25NZXRyaWNzIiwiYWN0aXZlQ291bnQiLCJpblVzZUNvdW50IiwiYXZhaWxhYmxlQ291bnQiLCJjcmVhdGVkQ291bnQiLCJjbG9zZWRDb3VudCIsInBlbmRpbmdDb3VudCIsImxhc3RIZWFsdGhDaGVjayIsImNvbm5lY3Rpb25MaWZldGltZSIsImF2ZXJhZ2VRdWVyeVRpbWUiLCJxdWVyaWVzUGVyU2Vjb25kIiwiQ29ubmVjdGlvblBvb2xNb25pdG9yIiwiY29uc3RydWN0b3IiLCJtZXRyaWNzIiwiaGVhbHRoQ2hlY2tJbnRlcnZhbCIsInBlcmZvcm1hbmNlT2JzZXJ2ZXIiLCJsaXN0IiwiZW50cmllcyIsImdldEVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJuYW1lIiwidXBkYXRlUXVlcnlNZXRyaWNzIiwiZHVyYXRpb24iLCJvYnNlcnZlIiwidHlwZSIsInN0YXJ0SGVhbHRoQ2hlY2tzIiwiaW50ZXJ2YWxNcyIsInNldEludGVydmFsIiwicGVyZm9ybUhlYWx0aENoZWNrIiwiaW5mbyIsInN0b3BIZWFsdGhDaGVja3MiLCJjbGVhckludGVydmFsIiwic3RhdHMiLCJjb25uZWN0aW9uIiwiZGIiLCJEYXRlIiwiYWN0aXZlQ29ubmVjdGlvbnMiLCJhdmFpbGFibGVDb25uZWN0aW9ucyIsInBlbmRpbmdPcGVyYXRpb25zIiwiZXJyb3IiLCJ1cGRhdGVQb29sTWV0cmljcyIsInJlYWR5U3RhdGUiLCJwb29sU2l6ZSIsInNlcnZlckNvbmZpZyIsIk1hdGgiLCJtYXgiLCJkZWJ1ZyIsIndhcm4iLCJtZXNzYWdlIiwiZ2V0TWV0cmljcyIsImNvbm5lY3Rpb25Nb25pdG9yIiwiY29ubmVjdERCIiwicmV0cmllcyIsImkiLCJzdGFydFRpbWUiLCJub3ciLCJjb25uIiwiY29ubmVjdCIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIm1heFBvb2xTaXplIiwibWluUG9vbFNpemUiLCJtYXhJZGxlVGltZU1TIiwic2VydmVyU2VsZWN0aW9uVGltZW91dE1TIiwic29ja2V0VGltZW91dE1TIiwiY29ubmVjdFRpbWVvdXRNUyIsImhlYXJ0YmVhdEZyZXF1ZW5jeU1TIiwiYnVmZmVyTWF4RW50cmllcyIsImJ1ZmZlckNvbW1hbmRzIiwiY29ubmVjdFRpbWUiLCJob3N0IiwidG9GaXhlZCIsIm9uIiwiZGF0YSIsInRvdGFsQ3JlYXRlZCIsInRvdGFsQ2xvc2VkIiwiZXJyIiwic2V0VGltZW91dCIsImFjdGl2ZSIsImluVXNlIiwiYXZhaWxhYmxlIiwicGVuZGluZyIsImRlbGF5IiwibWluIiwicG93IiwiUHJvbWlzZSIsInJlc29sdmUiLCJjbG9zZURCIiwiY2xvc2UiLCJmb3JjZUVycm9yIiwiZ2V0Q29ubmVjdGlvblN0YXR1cyIsImlzQ29ubmVjdGVkIiwiZGF0YWJhc2UiLCJ0cmFja1F1ZXJ5UGVyZm9ybWFuY2UiLCJxdWVyeU5hbWUiLCJuZXh0Iiwic3RhcnQiLCJtYXJrIiwicmVzdWx0IiwiZW5kIiwibWVhc3VyZSIsImNsZWFyTWFya3MiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiY29ubmVjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XG5jb25zdCB3aW5zdG9uID0gcmVxdWlyZSgnd2luc3RvbicpO1xuY29uc3QgeyBwZXJmb3JtYW5jZSwgUGVyZm9ybWFuY2VPYnNlcnZlciB9ID0gcmVxdWlyZSgncGVyZl9ob29rcycpO1xuXG5jb25zdCBsb2dnZXIgPSB3aW5zdG9uLmNyZWF0ZUxvZ2dlcih7XG4gIGxldmVsOiAnaW5mbycsXG4gIGZvcm1hdDogd2luc3Rvbi5mb3JtYXQuY29tYmluZShcbiAgICB3aW5zdG9uLmZvcm1hdC50aW1lc3RhbXAoKSxcbiAgICB3aW5zdG9uLmZvcm1hdC5lcnJvcnMoeyBzdGFjazogdHJ1ZSB9KSxcbiAgICB3aW5zdG9uLmZvcm1hdC5qc29uKClcbiAgKSxcbiAgZGVmYXVsdE1ldGE6IHsgc2VydmljZTogJ2RhdGFiYXNlJyB9LFxuICB0cmFuc3BvcnRzOiBbXG4gICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5GaWxlKHsgZmlsZW5hbWU6ICdsb2dzL2RhdGFiYXNlLmxvZycgfSksXG4gICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKHtcbiAgICAgIGZvcm1hdDogd2luc3Rvbi5mb3JtYXQuY29tYmluZShcbiAgICAgICAgd2luc3Rvbi5mb3JtYXQuY29sb3JpemUoKSxcbiAgICAgICAgd2luc3Rvbi5mb3JtYXQuc2ltcGxlKClcbiAgICAgIClcbiAgICB9KVxuICBdXG59KTtcblxuLy8gQ29ubmVjdGlvbiBwb29sIG1ldHJpY3NcbmxldCBjb25uZWN0aW9uTWV0cmljcyA9IHtcbiAgYWN0aXZlQ291bnQ6IDAsXG4gIGluVXNlQ291bnQ6IDAsXG4gIGF2YWlsYWJsZUNvdW50OiAwLFxuICBjcmVhdGVkQ291bnQ6IDAsXG4gIGNsb3NlZENvdW50OiAwLFxuICBwZW5kaW5nQ291bnQ6IDAsXG4gIGxhc3RIZWFsdGhDaGVjazogbnVsbCxcbiAgY29ubmVjdGlvbkxpZmV0aW1lOiAwLFxuICBhdmVyYWdlUXVlcnlUaW1lOiAwLFxuICBxdWVyaWVzUGVyU2Vjb25kOiAwXG59O1xuXG5jbGFzcyBDb25uZWN0aW9uUG9vbE1vbml0b3Ige1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLm1ldHJpY3MgPSBjb25uZWN0aW9uTWV0cmljcztcbiAgICB0aGlzLmhlYWx0aENoZWNrSW50ZXJ2YWwgPSBudWxsO1xuICAgIHRoaXMucGVyZm9ybWFuY2VPYnNlcnZlciA9IG5ldyBQZXJmb3JtYW5jZU9ic2VydmVyKChsaXN0KSA9PiB7XG4gICAgICBjb25zdCBlbnRyaWVzID0gbGlzdC5nZXRFbnRyaWVzKCk7XG4gICAgICBlbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7XG4gICAgICAgIGlmIChlbnRyeS5uYW1lID09PSAnbW9uZ29kYi1xdWVyeScpIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVF1ZXJ5TWV0cmljcyhlbnRyeS5kdXJhdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHRoaXMucGVyZm9ybWFuY2VPYnNlcnZlci5vYnNlcnZlKHsgdHlwZTogJ21lYXN1cmUnIH0pO1xuICB9XG5cbiAgc3RhcnRIZWFsdGhDaGVja3MoaW50ZXJ2YWxNcyA9IDMwMDAwKSB7XG4gICAgdGhpcy5oZWFsdGhDaGVja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdGhpcy5wZXJmb3JtSGVhbHRoQ2hlY2soKTtcbiAgICB9LCBpbnRlcnZhbE1zKTtcbiAgICBsb2dnZXIuaW5mbygnQ29ubmVjdGlvbiBwb29sIGhlYWx0aCBjaGVja3Mgc3RhcnRlZCcpO1xuICB9XG5cbiAgc3RvcEhlYWx0aENoZWNrcygpIHtcbiAgICBpZiAodGhpcy5oZWFsdGhDaGVja0ludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuaGVhbHRoQ2hlY2tJbnRlcnZhbCk7XG4gICAgICB0aGlzLmhlYWx0aENoZWNrSW50ZXJ2YWwgPSBudWxsO1xuICAgICAgbG9nZ2VyLmluZm8oJ0Nvbm5lY3Rpb24gcG9vbCBoZWFsdGggY2hlY2tzIHN0b3BwZWQnKTtcbiAgICB9XG4gIH1cblxuICBwZXJmb3JtSGVhbHRoQ2hlY2soKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXRzID0gbW9uZ29vc2UuY29ubmVjdGlvbi5kYi5zdGF0cygpO1xuICAgICAgdGhpcy5tZXRyaWNzLmxhc3RIZWFsdGhDaGVjayA9IG5ldyBEYXRlKCk7XG4gICAgICBsb2dnZXIuaW5mbygnQ29ubmVjdGlvbiBwb29sIGhlYWx0aCBjaGVjayBwYXNzZWQnLCB7XG4gICAgICAgIGFjdGl2ZUNvbm5lY3Rpb25zOiB0aGlzLm1ldHJpY3MuYWN0aXZlQ291bnQsXG4gICAgICAgIGF2YWlsYWJsZUNvbm5lY3Rpb25zOiB0aGlzLm1ldHJpY3MuYXZhaWxhYmxlQ291bnQsXG4gICAgICAgIHBlbmRpbmdPcGVyYXRpb25zOiB0aGlzLm1ldHJpY3MucGVuZGluZ0NvdW50XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdDb25uZWN0aW9uIHBvb2wgaGVhbHRoIGNoZWNrIGZhaWxlZDonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlUXVlcnlNZXRyaWNzKGR1cmF0aW9uKSB7XG4gICAgdGhpcy5tZXRyaWNzLmF2ZXJhZ2VRdWVyeVRpbWUgPSAodGhpcy5tZXRyaWNzLmF2ZXJhZ2VRdWVyeVRpbWUgKyBkdXJhdGlvbikgLyAyO1xuICAgIHRoaXMubWV0cmljcy5xdWVyaWVzUGVyU2Vjb25kID0gMTAwMCAvIGR1cmF0aW9uOyAvLyBhcHByb3hpbWF0ZVxuICB9XG5cbiAgdXBkYXRlUG9vbE1ldHJpY3MoKSB7XG4gICAgaWYgKG1vbmdvb3NlLmNvbm5lY3Rpb24ucmVhZHlTdGF0ZSA9PT0gMSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcG9vbFNpemUgPSBtb25nb29zZS5jb25uZWN0aW9uLmRiLnNlcnZlckNvbmZpZy5wb29sU2l6ZSB8fCAwO1xuICAgICAgICB0aGlzLm1ldHJpY3MuYWN0aXZlQ291bnQgPSBwb29sU2l6ZTtcbiAgICAgICAgdGhpcy5tZXRyaWNzLmF2YWlsYWJsZUNvdW50ID0gTWF0aC5tYXgoMCwgMjAgLSB0aGlzLm1ldHJpY3MuaW5Vc2VDb3VudCk7IC8vIGFzc3VtaW5nIG1heFBvb2xTaXplID0gMjBcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdQb29sIG1ldHJpY3MgdXBkYXRlZCcsIHRoaXMubWV0cmljcyk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIud2FybignRmFpbGVkIHRvIGdldCBwb29sIG1ldHJpY3M6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0TWV0cmljcygpIHtcbiAgICB0aGlzLnVwZGF0ZVBvb2xNZXRyaWNzKCk7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5tZXRyaWNzIH07XG4gIH1cbn1cblxuLy8gSW5pdGlhbGl6ZSBjb25uZWN0aW9uIG1vbml0b3JcbmNvbnN0IGNvbm5lY3Rpb25Nb25pdG9yID0gbmV3IENvbm5lY3Rpb25Qb29sTW9uaXRvcigpO1xuXG5jb25zdCBjb25uZWN0REIgPSBhc3luYyAocmV0cmllcyA9IDUpID0+IHtcbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gcmV0cmllczsgaSsrKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgICBjb25zdCBjb25uID0gYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSwge1xuICAgICAgICBtYXhQb29sU2l6ZTogMjAsICAgICAgICAgICAvLyBNYXhpbXVtIDIwIGNvbm5lY3Rpb25zIGluIHRoZSBwb29sXG4gICAgICAgIG1pblBvb2xTaXplOiA1LCAgICAgICAgICAgIC8vIE1haW50YWluIG1pbmltdW0gNSBjb25uZWN0aW9uc1xuICAgICAgICBtYXhJZGxlVGltZU1TOiAzMDAwMCwgICAgICAvLyBDbG9zZSBjb25uZWN0aW9ucyBhZnRlciAzMHMgb2YgaW5hY3Rpdml0eVxuICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDMwMDAwLFxuICAgICAgICBzb2NrZXRUaW1lb3V0TVM6IDQ1MDAwLFxuICAgICAgICBjb25uZWN0VGltZW91dE1TOiAzMDAwMCxcbiAgICAgICAgaGVhcnRiZWF0RnJlcXVlbmN5TVM6IDEwMDAwLCAvLyBDaGVjayBoZWFsdGggZXZlcnkgMTAgc2Vjb25kc1xuICAgICAgICBidWZmZXJNYXhFbnRyaWVzOiAwLCAgICAgICAvLyBEaXNhYmxlIG1vbmdvb3NlIGJ1ZmZlcmluZ1xuICAgICAgICBidWZmZXJDb21tYW5kczogZmFsc2UsICAgICAvLyBEaXNhYmxlIG1vbmdvb3NlIGJ1ZmZlcmluZ1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNvbm5lY3RUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBjb25uZWN0aW9uTW9uaXRvci5tZXRyaWNzLmNvbm5lY3Rpb25MaWZldGltZSA9IGNvbm5lY3RUaW1lO1xuXG4gICAgICBsb2dnZXIuaW5mbyhgTW9uZ29EQiBDb25uZWN0ZWQ6ICR7Y29ubi5jb25uZWN0aW9uLmhvc3R9ICgke2Nvbm5lY3RUaW1lLnRvRml4ZWQoMil9bXMpYCk7XG5cbiAgICAgIC8vIFN0YXJ0IGNvbm5lY3Rpb24gbW9uaXRvcmluZ1xuICAgICAgY29ubmVjdGlvbk1vbml0b3Iuc3RhcnRIZWFsdGhDaGVja3MoKTtcblxuICAgICAgLy8gSGFuZGxlIGNvbm5lY3Rpb24gZXZlbnRzIHdpdGggZW5oYW5jZWQgdHJhY2tpbmdcbiAgICAgIG1vbmdvb3NlLmNvbm5lY3Rpb24ub24oJ2Nvbm5lY3Rpb25DcmVhdGVkJywgKGRhdGEpID0+IHtcbiAgICAgICAgY29ubmVjdGlvbk1vbml0b3IubWV0cmljcy5jcmVhdGVkQ291bnQrKztcbiAgICAgICAgY29ubmVjdGlvbk1vbml0b3IubWV0cmljcy5hY3RpdmVDb3VudCsrO1xuICAgICAgICBsb2dnZXIuaW5mbygnQ29ubmVjdGlvbiBjcmVhdGVkJywge1xuICAgICAgICAgIHRvdGFsQ3JlYXRlZDogY29ubmVjdGlvbk1vbml0b3IubWV0cmljcy5jcmVhdGVkQ291bnQsXG4gICAgICAgICAgYWN0aXZlQ291bnQ6IGNvbm5lY3Rpb25Nb25pdG9yLm1ldHJpY3MuYWN0aXZlQ291bnRcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgbW9uZ29vc2UuY29ubmVjdGlvbi5vbignY29ubmVjdGlvbkNsb3NlZCcsIChkYXRhKSA9PiB7XG4gICAgICAgIGNvbm5lY3Rpb25Nb25pdG9yLm1ldHJpY3MuY2xvc2VkQ291bnQrKztcbiAgICAgICAgY29ubmVjdGlvbk1vbml0b3IubWV0cmljcy5hY3RpdmVDb3VudCA9IE1hdGgubWF4KDAsIGNvbm5lY3Rpb25Nb25pdG9yLm1ldHJpY3MuYWN0aXZlQ291bnQgLSAxKTtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ0Nvbm5lY3Rpb24gY2xvc2VkJywge1xuICAgICAgICAgIHRvdGFsQ2xvc2VkOiBjb25uZWN0aW9uTW9uaXRvci5tZXRyaWNzLmNsb3NlZENvdW50LFxuICAgICAgICAgIGFjdGl2ZUNvdW50OiBjb25uZWN0aW9uTW9uaXRvci5tZXRyaWNzLmFjdGl2ZUNvdW50XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIG1vbmdvb3NlLmNvbm5lY3Rpb24ub24oJ2Nvbm5lY3Rpb25SZWFkeScsIChkYXRhKSA9PiB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQ29ubmVjdGlvbiByZWFkeSBmb3IgdXNlJyk7XG4gICAgICB9KTtcblxuICAgICAgbW9uZ29vc2UuY29ubmVjdGlvbi5vbignY29ubmVjdGlvbkxlYXNlZCcsIChkYXRhKSA9PiB7XG4gICAgICAgIGNvbm5lY3Rpb25Nb25pdG9yLm1ldHJpY3MuaW5Vc2VDb3VudCsrO1xuICAgICAgICBsb2dnZXIuZGVidWcoYENvbm5lY3Rpb24gbGVhc2VkIC0gSW4gdXNlOiAke2Nvbm5lY3Rpb25Nb25pdG9yLm1ldHJpY3MuaW5Vc2VDb3VudH1gKTtcbiAgICAgIH0pO1xuXG4gICAgICBtb25nb29zZS5jb25uZWN0aW9uLm9uKCdjb25uZWN0aW9uUmV0dXJuZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICBjb25uZWN0aW9uTW9uaXRvci5tZXRyaWNzLmluVXNlQ291bnQgPSBNYXRoLm1heCgwLCBjb25uZWN0aW9uTW9uaXRvci5tZXRyaWNzLmluVXNlQ291bnQgLSAxKTtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBDb25uZWN0aW9uIHJldHVybmVkIC0gQXZhaWxhYmxlOiAke2Nvbm5lY3Rpb25Nb25pdG9yLm1ldHJpY3MuYXZhaWxhYmxlQ291bnR9YCk7XG4gICAgICB9KTtcblxuICAgICAgbW9uZ29vc2UuY29ubmVjdGlvbi5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBlcnJvcjonLCBlcnIpO1xuICAgICAgfSk7XG5cbiAgICAgIG1vbmdvb3NlLmNvbm5lY3Rpb24ub24oJ2Rpc2Nvbm5lY3RlZCcsICgpID0+IHtcbiAgICAgICAgY29ubmVjdGlvbk1vbml0b3Iuc3RvcEhlYWx0aENoZWNrcygpO1xuICAgICAgICBsb2dnZXIud2FybignRGF0YWJhc2UgZGlzY29ubmVjdGVkJyk7XG5cbiAgICAgICAgLy8gRW5oYW5jZWQgcmVjb25uZWN0aW9uIHN0cmF0ZWd5IHdpdGggZXhwb25lbnRpYWwgYmFja29mZlxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBsb2dnZXIuaW5mbygnQXR0ZW1wdGluZyBhdXRvbWF0ZWQgcmVjb25uZWN0aW9uLi4uJyk7XG4gICAgICAgICAgY29ubmVjdERCKDMpOyAvLyAzIHJldHJpZXMgb24gZGlzY29ubmVjdGlvblxuICAgICAgICB9LCA1MDAwKTtcbiAgICAgIH0pO1xuXG4gICAgICBtb25nb29zZS5jb25uZWN0aW9uLm9uKCdyZWNvbm5lY3RlZCcsICgpID0+IHtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ0RhdGFiYXNlIHJlY29ubmVjdGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICBjb25uZWN0aW9uTW9uaXRvci5zdGFydEhlYWx0aENoZWNrcygpOyAvLyBSZXN0YXJ0IGhlYWx0aCBjaGVja3NcbiAgICAgIH0pO1xuXG4gICAgICBtb25nb29zZS5jb25uZWN0aW9uLm9uKCdyZWNvbm5lY3RGYWlsZWQnLCAoZXJyKSA9PiB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignRGF0YWJhc2UgcmVjb25uZWN0aW9uIGZhaWxlZDonLCBlcnIpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFBlcmlvZGljIHBvb2wgc3RhdHVzIGxvZ2dpbmdcbiAgICAgIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgY29uc3QgbWV0cmljcyA9IGNvbm5lY3Rpb25Nb25pdG9yLmdldE1ldHJpY3MoKTtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ0Nvbm5lY3Rpb24gUG9vbCBTdGF0dXMnLCB7XG4gICAgICAgICAgYWN0aXZlOiBtZXRyaWNzLmFjdGl2ZUNvdW50LFxuICAgICAgICAgIGluVXNlOiBtZXRyaWNzLmluVXNlQ291bnQsXG4gICAgICAgICAgYXZhaWxhYmxlOiBtZXRyaWNzLmF2YWlsYWJsZUNvdW50LFxuICAgICAgICAgIHBlbmRpbmc6IG1ldHJpY3MucGVuZGluZ0NvdW50LFxuICAgICAgICAgIGF2ZXJhZ2VRdWVyeVRpbWU6IGAke21ldHJpY3MuYXZlcmFnZVF1ZXJ5VGltZS50b0ZpeGVkKDIpfW1zYCxcbiAgICAgICAgICBxdWVyaWVzUGVyU2Vjb25kOiBtZXRyaWNzLnF1ZXJpZXNQZXJTZWNvbmQudG9GaXhlZCgyKVxuICAgICAgICB9KTtcbiAgICAgIH0sIDYwMDAwKTsgLy8gTG9nIGV2ZXJ5IG1pbnV0ZVxuXG4gICAgICByZXR1cm4gY29ubjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKGBEYXRhYmFzZSBjb25uZWN0aW9uIGF0dGVtcHQgJHtpfS8ke3JldHJpZXN9IGZhaWxlZDpgLCBlcnJvcik7XG5cbiAgICAgIGlmIChpID09PSByZXRyaWVzKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQgYWZ0ZXIgYWxsIHJldHJpZXM6JywgZXJyb3IpO1xuICAgICAgICB0aHJvdyBlcnJvcjsgLy8gTGV0IHRoZSBjYWxsZXIgaGFuZGxlIGl0XG4gICAgICB9XG5cbiAgICAgIC8vIEV4cG9uZW50aWFsIGJhY2tvZmYgZm9yIHJldHJpZXNcbiAgICAgIGNvbnN0IGRlbGF5ID0gTWF0aC5taW4oMTAwMCAqIE1hdGgucG93KDIsIGkgLSAxKSwgMzAwMDApO1xuICAgICAgbG9nZ2VyLmluZm8oYFJldHJ5aW5nIGRhdGFiYXNlIGNvbm5lY3Rpb24gaW4gJHtkZWxheX1tcy4uLmApO1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5KSk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBjbG9zZURCID0gYXN5bmMgKCkgPT4ge1xuICB0cnkge1xuICAgIC8vIFN0b3AgaGVhbHRoIGNoZWNrcyBiZWZvcmUgY2xvc2luZ1xuICAgIGNvbm5lY3Rpb25Nb25pdG9yLnN0b3BIZWFsdGhDaGVja3MoKTtcblxuICAgIGlmIChtb25nb29zZS5jb25uZWN0aW9uLnJlYWR5U3RhdGUgPT09IDEpIHtcbiAgICAgIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3Rpb24uY2xvc2UoKTtcbiAgICAgIGxvZ2dlci5pbmZvKCdEYXRhYmFzZSBjb25uZWN0aW9uIGNsb3NlZCBncmFjZWZ1bGx5Jyk7XG4gICAgICBsb2dnZXIuaW5mbygnRmluYWwgY29ubmVjdGlvbiBtZXRyaWNzOicsIGNvbm5lY3Rpb25Nb25pdG9yLmdldE1ldHJpY3MoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5pbmZvKCdEYXRhYmFzZSBjb25uZWN0aW9uIHdhcyBub3Qgb3Blbiwgbm8gbmVlZCB0byBjbG9zZScpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGNsb3NpbmcgZGF0YWJhc2UgY29ubmVjdGlvbjonLCBlcnJvcik7XG4gICAgLy8gRm9yY2UgY2xvc2UgaWYgZ3JhY2VmdWwgY2xvc2UgZmFpbHNcbiAgICB0cnkge1xuICAgICAgbW9uZ29vc2UuY29ubmVjdGlvbi5jbG9zZSh0cnVlKTtcbiAgICAgIGxvZ2dlci53YXJuKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZvcmNlIGNsb3NlZCcpO1xuICAgIH0gY2F0Y2ggKGZvcmNlRXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRm9yY2UgY2xvc2UgZmFpbGVkOicsIGZvcmNlRXJyb3IpO1xuICAgIH1cbiAgfVxufTtcblxuLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBnZXQgY29ubmVjdGlvbiBzdGF0dXNcbmNvbnN0IGdldENvbm5lY3Rpb25TdGF0dXMgPSAoKSA9PiB7XG4gIHJldHVybiB7XG4gICAgaXNDb25uZWN0ZWQ6IG1vbmdvb3NlLmNvbm5lY3Rpb24ucmVhZHlTdGF0ZSA9PT0gMSxcbiAgICByZWFkeVN0YXRlOiBtb25nb29zZS5jb25uZWN0aW9uLnJlYWR5U3RhdGUsXG4gICAgaG9zdDogbW9uZ29vc2UuY29ubmVjdGlvbi5ob3N0IHx8IG51bGwsXG4gICAgZGF0YWJhc2U6IG1vbmdvb3NlLmNvbm5lY3Rpb24ubmFtZSB8fCBudWxsLFxuICAgIG1ldHJpY3M6IGNvbm5lY3Rpb25Nb25pdG9yLmdldE1ldHJpY3MoKVxuICB9O1xufTtcblxuLy8gTWlkZGxld2FyZSBmdW5jdGlvbiB0byB0cmFjayBxdWVyeSBwZXJmb3JtYW5jZSAoY2FuIGJlIHVzZWQgaW4gcm91dGVzKVxuY29uc3QgdHJhY2tRdWVyeVBlcmZvcm1hbmNlID0gKHF1ZXJ5TmFtZSkgPT4ge1xuICByZXR1cm4gYXN5bmMgKG5leHQpID0+IHtcbiAgICBjb25zdCBzdGFydCA9IHBlcmZvcm1hbmNlLm1hcmsoYCR7cXVlcnlOYW1lfS1zdGFydGApO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBuZXh0KCk7XG4gICAgICBjb25zdCBlbmQgPSBwZXJmb3JtYW5jZS5tYXJrKGAke3F1ZXJ5TmFtZX0tZW5kYCk7XG4gICAgICBwZXJmb3JtYW5jZS5tZWFzdXJlKGAke3F1ZXJ5TmFtZX0tZHVyYXRpb25gLCBgJHtxdWVyeU5hbWV9LXN0YXJ0YCwgYCR7cXVlcnlOYW1lfS1lbmRgKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHBlcmZvcm1hbmNlLmNsZWFyTWFya3MoYCR7cXVlcnlOYW1lfS1zdGFydGApO1xuICAgICAgcGVyZm9ybWFuY2UuY2xlYXJNYXJrcyhgJHtxdWVyeU5hbWV9LWVuZGApO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNvbm5lY3REQixcbiAgY2xvc2VEQixcbiAgZ2V0Q29ubmVjdGlvblN0YXR1cyxcbiAgdHJhY2tRdWVyeVBlcmZvcm1hbmNlLFxuICBjb25uZWN0aW9uTW9uaXRvclxufTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUNwQyxNQUFNQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTTtFQUFFRSxXQUFXO0VBQUVDO0FBQW9CLENBQUMsR0FBR0gsT0FBTyxDQUFDLFlBQVksQ0FBQztBQUVsRSxNQUFNSSxNQUFNLEdBQUdILE9BQU8sQ0FBQ0ksWUFBWSxDQUFDO0VBQ2xDQyxLQUFLLEVBQUUsTUFBTTtFQUNiQyxNQUFNLEVBQUVOLE9BQU8sQ0FBQ00sTUFBTSxDQUFDQyxPQUFPLENBQzVCUCxPQUFPLENBQUNNLE1BQU0sQ0FBQ0UsU0FBUyxDQUFDLENBQUMsRUFDMUJSLE9BQU8sQ0FBQ00sTUFBTSxDQUFDRyxNQUFNLENBQUM7SUFBRUMsS0FBSyxFQUFFO0VBQUssQ0FBQyxDQUFDLEVBQ3RDVixPQUFPLENBQUNNLE1BQU0sQ0FBQ0ssSUFBSSxDQUFDLENBQ3RCLENBQUM7RUFDREMsV0FBVyxFQUFFO0lBQUVDLE9BQU8sRUFBRTtFQUFXLENBQUM7RUFDcENDLFVBQVUsRUFBRSxDQUNWLElBQUlkLE9BQU8sQ0FBQ2Ms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