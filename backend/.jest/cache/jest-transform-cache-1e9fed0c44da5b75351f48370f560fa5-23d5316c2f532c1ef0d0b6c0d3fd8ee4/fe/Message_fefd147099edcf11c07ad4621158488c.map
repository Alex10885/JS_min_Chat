{"version":3,"names":["mongoose","require","messageSchema","Schema","author","type","String","required","trim","text","maxlength","channel","index","enum","default","target","timestamp","Date","now","status","replyTo","Types","ObjectId","ref","createdAt","pre","next","isNew","module","exports","model"],"sources":["Message.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst messageSchema = new mongoose.Schema({\n  author: {\n    type: String,\n    required: true,\n    trim: true\n  },\n  text: {\n    type: String,\n    required: true,\n    maxlength: 2000\n  },\n  channel: {\n    type: String,\n    required: true,\n    index: true\n  },\n  type: {\n    type: String,\n    enum: ['public', 'private', 'system'],\n    default: 'public'\n  },\n  target: {\n    type: String,\n    trim: true,\n    default: null\n  },\n  timestamp: {\n    type: Date,\n    default: Date.now,\n    index: true\n  },\n  status: {\n    type: String,\n    enum: ['delivered', 'failed'],\n    default: 'delivered'\n  },\n  replyTo: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Message',\n    default: null\n  }\n});\n\n// Optimized indexes for performance and queries\nmessageSchema.index({ channel: 1, timestamp: -1 }); // For channel history\nmessageSchema.index({ channel: 1, type: 1, timestamp: -1 }); // For filtered queries\nmessageSchema.index({ author: 1, timestamp: -1 }); // For user message history\n\n// Compound index for private messages with pagination\nmessageSchema.index({ channel: 1, author: 1, target: 1, timestamp: -1 });\n\n// Text index for message search (optional, for future features)\n// messageSchema.index({ text: 'text' });\n\n// Index for reply relationships\nmessageSchema.index({ replyTo: 1 });\n\n// Index for message counting and cleanup\nmessageSchema.index({ channel: 1, createdAt: -1 }); // Alternative to direct timestamp\n\n// Limit history retrieval (keep recent messages)\nmessageSchema.pre('save', function(next) {\n  if (this.isNew && this.type === 'system') {\n    // System messages don't need complex processing\n    return next();\n  }\n  next();\n});\n\nmodule.exports = mongoose.model('Message', messageSchema);"],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,aAAa,GAAG,IAAIF,QAAQ,CAACG,MAAM,CAAC;EACxCC,MAAM,EAAE;IACNC,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,IAAI;IACdC,IAAI,EAAE;EACR,CAAC;EACDC,IAAI,EAAE;IACJJ,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,IAAI;IACdG,SAAS,EAAE;EACb,CAAC;EACDC,OAAO,EAAE;IACPN,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,IAAI;IACdK,KAAK,EAAE;EACT,CAAC;EACDP,IAAI,EAAE;IACJA,IAAI,EAAEC,MAAM;IACZO,IAAI,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAE,QAAQ,CAAC;IACrCC,OAAO,EAAE;EACX,CAAC;EACDC,MAAM,EAAE;IACNV,IAAI,EAAEC,MAAM;IACZE,IAAI,EAAE,IAAI;IACVM,OAAO,EAAE;EACX,CAAC;EACDE,SAAS,EAAE;IACTX,IAAI,EAAEY,IAAI;IACVH,OAAO,EAAEG,IAAI,CAACC,GAAG;IACjBN,KAAK,EAAE;EACT,CAAC;EACDO,MAAM,EAAE;IACNd,IAAI,EAAEC,MAAM;IACZO,IAAI,EAAE,CAAC,WAAW,EAAE,QAAQ,CAAC;IAC7BC,OAAO,EAAE;EACX,CAAC;EACDM,OAAO,EAAE;IACPf,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACkB,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,SAAS;IACdT,OAAO,EAAE;EACX;AACF,CAAC,CAAC;;AAEF;AACAZ,aAAa,CAACU,KAAK,CAAC;EAAED,OAAO,EAAE,CAAC;EAAEK,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC,CAAC,CAAC;AACpDd,aAAa,CAACU,KAAK,CAAC;EAAED,OAAO,EAAE,CAAC;EAAEN,IAAI,EAAE,CAAC;EAAEW,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC,CAAC,CAAC;AAC7Dd,aAAa,CAACU,KAAK,CAAC;EAAER,MAAM,EAAE,CAAC;EAAEY,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC,CAAC,CAAC;;AAEnD;AACAd,aAAa,CAACU,KAAK,CAAC;EAAED,OAAO,EAAE,CAAC;EAAEP,MAAM,EAAE,CAAC;EAAEW,MAAM,EAAE,CAAC;EAAEC,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC;;AAExE;AACA;;AAEA;AACAd,aAAa,CAACU,KAAK,CAAC;EAAEQ,OAAO,EAAE;AAAE,CAAC,CAAC;;AAEnC;AACAlB,aAAa,CAACU,KAAK,CAAC;EAAED,OAAO,EAAE,CAAC;EAAEa,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC,CAAC,CAAC;;AAEpD;AACAtB,aAAa,CAACuB,GAAG,CAAC,MAAM,EAAE,UAASC,IAAI,EAAE;EACvC,IAAI,IAAI,CAACC,KAAK,IAAI,IAAI,CAACtB,IAAI,KAAK,QAAQ,EAAE;IACxC;IACA,OAAOqB,IAAI,CAAC,CAAC;EACf;EACAA,IAAI,CAAC,CAAC;AACR,CAAC,CAAC;AAEFE,MAAM,CAACC,OAAO,GAAG7B,QAAQ,CAAC8B,KAAK,CAAC,SAAS,EAAE5B,aAAa,CAAC","ignoreList":[]}