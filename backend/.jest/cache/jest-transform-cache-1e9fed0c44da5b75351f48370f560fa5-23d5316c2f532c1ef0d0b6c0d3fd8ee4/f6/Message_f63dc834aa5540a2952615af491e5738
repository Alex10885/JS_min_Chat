f62e44bb7811612138281007584023e9
/* istanbul ignore next */
function cov_axc4n7ug8() {
  var path = "/home/raerlim/Chat-JS/backend/models/Message.js";
  var hash = "c874cca1b80f1223841180934441731d9b643804";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/raerlim/Chat-JS/backend/models/Message.js",
    statementMap: {
      "0": {
        start: {
          line: 1,
          column: 17
        },
        end: {
          line: 1,
          column: 36
        }
      },
      "1": {
        start: {
          line: 3,
          column: 22
        },
        end: {
          line: 44,
          column: 2
        }
      },
      "2": {
        start: {
          line: 47,
          column: 0
        },
        end: {
          line: 47,
          column: 51
        }
      },
      "3": {
        start: {
          line: 48,
          column: 0
        },
        end: {
          line: 48,
          column: 60
        }
      },
      "4": {
        start: {
          line: 49,
          column: 0
        },
        end: {
          line: 49,
          column: 50
        }
      },
      "5": {
        start: {
          line: 52,
          column: 0
        },
        end: {
          line: 52,
          column: 73
        }
      },
      "6": {
        start: {
          line: 58,
          column: 0
        },
        end: {
          line: 58,
          column: 36
        }
      },
      "7": {
        start: {
          line: 61,
          column: 0
        },
        end: {
          line: 61,
          column: 51
        }
      },
      "8": {
        start: {
          line: 64,
          column: 0
        },
        end: {
          line: 70,
          column: 3
        }
      },
      "9": {
        start: {
          line: 65,
          column: 2
        },
        end: {
          line: 68,
          column: 3
        }
      },
      "10": {
        start: {
          line: 67,
          column: 4
        },
        end: {
          line: 67,
          column: 18
        }
      },
      "11": {
        start: {
          line: 69,
          column: 2
        },
        end: {
          line: 69,
          column: 9
        }
      },
      "12": {
        start: {
          line: 72,
          column: 0
        },
        end: {
          line: 72,
          column: 58
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 64,
            column: 26
          },
          end: {
            line: 64,
            column: 27
          }
        },
        loc: {
          start: {
            line: 64,
            column: 41
          },
          end: {
            line: 70,
            column: 1
          }
        },
        line: 64
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 65,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 65,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 65
      },
      "1": {
        loc: {
          start: {
            line: 65,
            column: 6
          },
          end: {
            line: 65,
            column: 42
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 65,
            column: 6
          },
          end: {
            line: 65,
            column: 16
          }
        }, {
          start: {
            line: 65,
            column: 20
          },
          end: {
            line: 65,
            column: 42
          }
        }],
        line: 65
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0
    },
    f: {
      "0": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "c874cca1b80f1223841180934441731d9b643804"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_axc4n7ug8 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_axc4n7ug8();
const mongoose =
/* istanbul ignore next */
(cov_axc4n7ug8().s[0]++, require('mongoose'));
const messageSchema =
/* istanbul ignore next */
(cov_axc4n7ug8().s[1]++, new mongoose.Schema({
  author: {
    type: String,
    required: true,
    trim: true
  },
  text: {
    type: String,
    required: true,
    maxlength: 2000
  },
  channel: {
    type: String,
    required: true,
    index: true
  },
  type: {
    type: String,
    enum: ['public', 'private', 'system'],
    default: 'public'
  },
  target: {
    type: String,
    trim: true,
    default: null
  },
  timestamp: {
    type: Date,
    default: Date.now,
    index: true
  },
  status: {
    type: String,
    enum: ['delivered', 'failed'],
    default: 'delivered'
  },
  replyTo: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Message',
    default: null
  }
}));

// Optimized indexes for performance and queries
/* istanbul ignore next */
cov_axc4n7ug8().s[2]++;
messageSchema.index({
  channel: 1,
  timestamp: -1
}); // For channel history
/* istanbul ignore next */
cov_axc4n7ug8().s[3]++;
messageSchema.index({
  channel: 1,
  type: 1,
  timestamp: -1
}); // For filtered queries
/* istanbul ignore next */
cov_axc4n7ug8().s[4]++;
messageSchema.index({
  author: 1,
  timestamp: -1
}); // For user message history

// Compound index for private messages with pagination
/* istanbul ignore next */
cov_axc4n7ug8().s[5]++;
messageSchema.index({
  channel: 1,
  author: 1,
  target: 1,
  timestamp: -1
});

// Text index for message search (optional, for future features)
// messageSchema.index({ text: 'text' });

// Index for reply relationships
/* istanbul ignore next */
cov_axc4n7ug8().s[6]++;
messageSchema.index({
  replyTo: 1
});

// Index for message counting and cleanup
/* istanbul ignore next */
cov_axc4n7ug8().s[7]++;
messageSchema.index({
  channel: 1,
  createdAt: -1
}); // Alternative to direct timestamp

// Limit history retrieval (keep recent messages)
/* istanbul ignore next */
cov_axc4n7ug8().s[8]++;
messageSchema.pre('save', function (next) {
  /* istanbul ignore next */
  cov_axc4n7ug8().f[0]++;
  cov_axc4n7ug8().s[9]++;
  if (
  /* istanbul ignore next */
  (cov_axc4n7ug8().b[1][0]++, this.isNew) &&
  /* istanbul ignore next */
  (cov_axc4n7ug8().b[1][1]++, this.type === 'system')) {
    /* istanbul ignore next */
    cov_axc4n7ug8().b[0][0]++;
    cov_axc4n7ug8().s[10]++;
    // System messages don't need complex processing
    return next();
  } else
  /* istanbul ignore next */
  {
    cov_axc4n7ug8().b[0][1]++;
  }
  cov_axc4n7ug8().s[11]++;
  next();
});
/* istanbul ignore next */
cov_axc4n7ug8().s[12]++;
module.exports = mongoose.model('Message', messageSchema);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfYXhjNG43dWc4IiwiYWN0dWFsQ292ZXJhZ2UiLCJtb25nb29zZSIsInMiLCJyZXF1aXJlIiwibWVzc2FnZVNjaGVtYSIsIlNjaGVtYSIsImF1dGhvciIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInRyaW0iLCJ0ZXh0IiwibWF4bGVuZ3RoIiwiY2hhbm5lbCIsImluZGV4IiwiZW51bSIsImRlZmF1bHQiLCJ0YXJnZXQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93Iiwic3RhdHVzIiwicmVwbHlUbyIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJjcmVhdGVkQXQiLCJwcmUiLCJuZXh0IiwiZiIsImIiLCJpc05ldyIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VzIjpbIk1lc3NhZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuXG5jb25zdCBtZXNzYWdlU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gIGF1dGhvcjoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICB0cmltOiB0cnVlXG4gIH0sXG4gIHRleHQ6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgbWF4bGVuZ3RoOiAyMDAwXG4gIH0sXG4gIGNoYW5uZWw6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgaW5kZXg6IHRydWVcbiAgfSxcbiAgdHlwZToge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICBlbnVtOiBbJ3B1YmxpYycsICdwcml2YXRlJywgJ3N5c3RlbSddLFxuICAgIGRlZmF1bHQ6ICdwdWJsaWMnXG4gIH0sXG4gIHRhcmdldDoge1xuICAgIHR5cGU6IFN0cmluZyxcbiAgICB0cmltOiB0cnVlLFxuICAgIGRlZmF1bHQ6IG51bGxcbiAgfSxcbiAgdGltZXN0YW1wOiB7XG4gICAgdHlwZTogRGF0ZSxcbiAgICBkZWZhdWx0OiBEYXRlLm5vdyxcbiAgICBpbmRleDogdHJ1ZVxuICB9LFxuICBzdGF0dXM6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgZW51bTogWydkZWxpdmVyZWQnLCAnZmFpbGVkJ10sXG4gICAgZGVmYXVsdDogJ2RlbGl2ZXJlZCdcbiAgfSxcbiAgcmVwbHlUbzoge1xuICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcbiAgICByZWY6ICdNZXNzYWdlJyxcbiAgICBkZWZhdWx0OiBudWxsXG4gIH1cbn0pO1xuXG4vLyBPcHRpbWl6ZWQgaW5kZXhlcyBmb3IgcGVyZm9ybWFuY2UgYW5kIHF1ZXJpZXNcbm1lc3NhZ2VTY2hlbWEuaW5kZXgoeyBjaGFubmVsOiAxLCB0aW1lc3RhbXA6IC0xIH0pOyAvLyBGb3IgY2hhbm5lbCBoaXN0b3J5XG5tZXNzYWdlU2NoZW1hLmluZGV4KHsgY2hhbm5lbDogMSwgdHlwZTogMSwgdGltZXN0YW1wOiAtMSB9KTsgLy8gRm9yIGZpbHRlcmVkIHF1ZXJpZXNcbm1lc3NhZ2VTY2hlbWEuaW5kZXgoeyBhdXRob3I6IDEsIHRpbWVzdGFtcDogLTEgfSk7IC8vIEZvciB1c2VyIG1lc3NhZ2UgaGlzdG9yeVxuXG4vLyBDb21wb3VuZCBpbmRleCBmb3IgcHJpdmF0ZSBtZXNzYWdlcyB3aXRoIHBhZ2luYXRpb25cbm1lc3NhZ2VTY2hlbWEuaW5kZXgoeyBjaGFubmVsOiAxLCBhdXRob3I6IDEsIHRhcmdldDogMSwgdGltZXN0YW1wOiAtMSB9KTtcblxuLy8gVGV4dCBpbmRleCBmb3IgbWVzc2FnZSBzZWFyY2ggKG9wdGlvbmFsLCBmb3IgZnV0dXJlIGZlYXR1cmVzKVxuLy8gbWVzc2FnZVNjaGVtYS5pbmRleCh7IHRleHQ6ICd0ZXh0JyB9KTtcblxuLy8gSW5kZXggZm9yIHJlcGx5IHJlbGF0aW9uc2hpcHNcbm1lc3NhZ2VTY2hlbWEuaW5kZXgoeyByZXBseVRvOiAxIH0pO1xuXG4vLyBJbmRleCBmb3IgbWVzc2FnZSBjb3VudGluZyBhbmQgY2xlYW51cFxubWVzc2FnZVNjaGVtYS5pbmRleCh7IGNoYW5uZWw6IDEsIGNyZWF0ZWRBdDogLTEgfSk7IC8vIEFsdGVybmF0aXZlIHRvIGRpcmVjdCB0aW1lc3RhbXBcblxuLy8gTGltaXQgaGlzdG9yeSByZXRyaWV2YWwgKGtlZXAgcmVjZW50IG1lc3NhZ2VzKVxubWVzc2FnZVNjaGVtYS5wcmUoJ3NhdmUnLCBmdW5jdGlvbihuZXh0KSB7XG4gIGlmICh0aGlzLmlzTmV3ICYmIHRoaXMudHlwZSA9PT0gJ3N5c3RlbScpIHtcbiAgICAvLyBTeXN0ZW0gbWVzc2FnZXMgZG9uJ3QgbmVlZCBjb21wbGV4IHByb2Nlc3NpbmdcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9XG4gIG5leHQoKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdNZXNzYWdlJywgbWVzc2FnZVNjaGVtYSk7Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBZVk7SUFBQUEsYUFBQSxZQUFBQSxDQUFBO01BQUEsT0FBQUMsY0FBQTtJQUFBO0VBQUE7RUFBQSxPQUFBQSxjQUFBO0FBQUE7QUFBQUQsYUFBQTtBQWZaLE1BQU1FLFFBQVE7QUFBQTtBQUFBLENBQUFGLGFBQUEsR0FBQUcsQ0FBQSxPQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLGFBQWE7QUFBQTtBQUFBLENBQUFMLGFBQUEsR0FBQUcs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