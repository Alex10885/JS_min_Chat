{"version":3,"names":["mongoose","require","bcrypt","crypto","userSchema","Schema","nickname","type","String","required","unique","trim","minlength","maxlength","index","email","lowercase","password","role","enum","default","createdAt","Date","now","lastActive","status","resetPasswordToken","resetPasswordExpires","pre","next","isModified","console","log","salt","genSalt","hash","error","message","methods","comparePassword","candidatePassword","compare","generateResetToken","resetToken","randomBytes","toString","createHash","update","digest","resetPassword","token","newPassword","hashedToken","Error","save","toJSON","userObject","toObject","module","exports","model"],"sources":["User.js"],"sourcesContent":["const mongoose = require('mongoose');\nconst bcrypt = require('bcryptjs');\nconst crypto = require('crypto');\n\nconst userSchema = new mongoose.Schema({\n  nickname: {\n    type: String,\n    required: true,\n    unique: true,\n    trim: true,\n    minlength: 3,\n    maxlength: 50,\n    index: true // Remove duplicate index call below\n  },\n  email: {\n    type: String,\n    required: true,\n    unique: true,\n    lowercase: true,\n    trim: true,\n    index: true // Remove duplicate index call below\n  },\n  password: {\n    type: String,\n    required: true,\n    minlength: 6\n  },\n  role: {\n    type: String,\n    enum: ['admin', 'member'],\n    default: 'member'\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  lastActive: {\n    type: Date,\n    default: Date.now\n  },\n  status: {\n    type: String,\n    enum: ['online', 'offline'],\n    default: 'offline'\n  },\n  resetPasswordToken: {\n    type: String,\n    default: null\n  },\n  resetPasswordExpires: {\n    type: Date,\n    default: null\n  }\n});\n\n// Hash password before saving\nuserSchema.pre('save', async function(next) {\n   if (!this.isModified('password')) return next();\n\n   console.log('Hashing password for user:', this.nickname);\n   try {\n     const salt = await bcrypt.genSalt(12);\n     console.log('Salt generated:', salt);\n     this.password = await bcrypt.hash(this.password, salt);\n     console.log('Password hashed successfully');\n     next();\n   } catch (error) {\n     console.error('Error hashing password:', error.message);\n     next(error);\n   }\n });\n\n// Compare password method\nuserSchema.methods.comparePassword = async function(candidatePassword) {\n  return bcrypt.compare(candidatePassword, this.password);\n};\n\n// Generate reset password token\nuserSchema.methods.generateResetToken = function() {\n  // Generate random token\n  const resetToken = crypto.randomBytes(32).toString('hex');\n\n  // Hash token before storing\n  this.resetPasswordToken = crypto\n    .createHash('sha256')\n    .update(resetToken)\n    .digest('hex');\n\n  // Set expiration (1 hour from now)\n  this.resetPasswordExpires = Date.now() + 60 * 60 * 1000; // 1 hour\n\n  return resetToken;\n};\n\n// Reset password using token\nuserSchema.methods.resetPassword = function(token, newPassword) {\n  const hashedToken = crypto\n    .createHash('sha256')\n    .update(token)\n    .digest('hex');\n\n  if (hashedToken !== this.resetPasswordToken) {\n    throw new Error('Invalid or expired password reset token');\n  }\n\n  if (Date.now() > this.resetPasswordExpires) {\n    throw new Error('Password reset token has expired');\n  }\n\n  this.password = newPassword;\n  this.resetPasswordToken = null;\n  this.resetPasswordExpires = null;\n\n  return this.save();\n};\n\n// Remove password from JSON output\nuserSchema.methods.toJSON = function() {\n  const userObject = this.toObject();\n  delete userObject.password;\n  return userObject;\n};\n\nmodule.exports = mongoose.model('User', userSchema);"],"mappings":"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","ignoreList":[]}