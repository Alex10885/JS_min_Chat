{"version":3,"names":["cov_15lus477ee","actualCoverage","Server","s","require","closeDB","ServerFactory","constructor","f","server","createServer","options","b","Error","start","initialize","error","console","stop","shutdown","gracefulShutdown","log","disconnect","process","exit","module","exports"],"sources":["index.js"],"sourcesContent":["const Server = require('./server');\nconst { closeDB } = require('../../db/connection');\n\nclass ServerFactory {\n  constructor() {\n    this.server = null;\n  }\n\n  createServer(options = {}) {\n    if (this.server) {\n      throw new Error('Server already created');\n    }\n\n    this.server = new Server(options);\n    return this.server;\n  }\n\n  async start() {\n    if (!this.server) {\n      this.server = new Server();\n    }\n\n    try {\n      await this.server.initialize();\n      return this.server;\n    } catch (error) {\n      console.error('Failed to start server:', error);\n      throw error;\n    }\n  }\n\n  async stop() {\n    if (this.server) {\n      await this.server.shutdown();\n      this.server = null;\n    }\n  }\n\n  async gracefulShutdown() {\n    console.log('Received shutdown signal, shutting down gracefully...');\n\n    try {\n      await this.stop();\n      await closeDB();\n\n      // Close Redis connection\n      const { disconnect } = require('./config/redis');\n      await disconnect();\n\n      console.log('Server and Redis shut down gracefully');\n      process.exit(0);\n    } catch (error) {\n      console.error('Error during graceful shutdown:', error);\n      process.exit(1);\n    }\n  }\n}\n\nmodule.exports = new ServerFactory();"],"mappings":"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","ignoreList":[]}