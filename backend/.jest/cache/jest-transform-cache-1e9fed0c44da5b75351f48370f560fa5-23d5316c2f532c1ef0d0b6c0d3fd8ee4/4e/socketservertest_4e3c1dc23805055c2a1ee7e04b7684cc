0ffa84c3057633893ec31196af59ba47
const http = require('http');
const socketIo = require('socket.io');
const express = require('express');
const jwt = require('jsonwebtoken');
const cors = require('cors');
const {
  connectDB,
  closeDB
} = require('../db/connection');
const User = require('../models/User');
const Channel = require('../models/Channel');
const Message = require('../models/Message');

// Test server for Socket.IO integration tests
class SocketTestServer {
  constructor(port = 0) {
    // Use 0 to get random available port
    this.port = port;
    this.app = express();
    this.server = http.createServer(this.app);
    this.io = socketIo(this.server, {
      cors: {
        origin: true,
        methods: ["GET", "POST"]
      }
    });
    this.onlineUsers = new Map();
    this.voiceChannels = new Map();
    this.userConnections = new Map(); // Track user connection counts

    this.setupExpress();
    this.setupSocketIO();
  }
  setupExpress() {
    this.app.use(cors());
    this.app.use(express.json());

    // Minimal auth route for getting tokens
    this.app.post('/test-login', async (req, res) => {
      try {
        const {
          nickname
        } = req.body;
        const user = await User.findOne({
          nickname
        });
        if (!user) {
          return res.status(404).json({
            error: 'User not found'
          });
        }

        // Set user as online for socket auth
        user.status = 'online';
        await user.save();
        const token = jwt.sign({
          id: user._id,
          nickname: user.nickname,
          role: user.role
        }, process.env.JWT_SECRET, {
          expiresIn: '24h'
        });
        res.json({
          token,
          user: {
            id: user._id,
            nickname: user.nickname,
            role: user.role
          }
        });
      } catch (error) {
        res.status(500).json({
          error: error.message
        });
      }
    });
  }
  setupSocketIO() {
    this.io.use(async (socket, next) => {
      const token = socket.handshake.auth.token;
      console.log('Socket.IO auth middleware: received token:', token ? token.substring(0, 20) + '...' : 'null');
      if (!token) {
        console.log('Socket.IO auth middleware: no token provided');
        return next(new Error('Authentication token required'));
      }
      try {
        const decoded = jwt.verify(token, process.env.JWT_SECRET);
        console.log('Socket.IO auth middleware: decoded token:', {
          id: decoded.id,
          nickname: decoded.nickname
        });
        const user = await User.findById(decoded.id);
        console.log('Socket.IO auth middleware: user found in DB:', user ? {
          id: user._id,
          status: user.status,
          nickname: user.nickname
        } : 'null');
        if (!user) {
          console.log('Socket.IO auth middleware: ERROR - user not found in DB');
          return next(new Error('User not found or not online'));
        }
        console.log('Socket.IO auth middleware: checking user status:', user.status);

        // Check if user is marked as offline during authentication
        if (user.status === 'offline') {
          console.log('Socket.IO auth middleware: ERROR - user status is offline');
          return next(new Error('User not found or not online'));
        }

        // Handle user status update based on connection count
        const userId = decoded.id;
        const connectionCount = this.userConnections.get(userId) || 0;
        const newConnectionCount = connectionCount + 1;
        this.userConnections.set(userId, newConnectionCount);
        console.log(`Socket.IO auth middleware: updating user ${userId} to online, connection count: ${newConnectionCount}`);

        // Update user status to online during authentication
        const updatedUser = await User.findOneAndUpdate({
          _id: userId
        }, {
          $set: {
            status: 'online',
            lastActive: new Date()
          }
        }, {
          new: true,
          runValidators: true
        });
        console.log('Socket.IO auth middleware: user updated to:', updatedUser ? {
          id: updatedUser._id,
          status: updatedUser.status
        } : 'null');
        socket.userId = decoded.id;
        socket.nickname = decoded.nickname;
        socket.role = decoded.role;
        console.log('Socket.IO auth middleware: authentication successful for user:', socket.nickname);
        return next();
      } catch (err) {
        console.log('Socket.IO auth middleware: ERROR during auth:', err.message);
        return next(new Error('Authentication failed'));
      }
    });
    this.io.on('connection', socket => {
      // Track online user
      this.onlineUsers.set(socket.id, {
        userId: socket.userId,
        nickname: socket.nickname,
        role: socket.role,
        room: null
      });
      socket.on('join_room', async data => {
        const {
          room
        } = data;
        if (!room || typeof room !== 'string' || room.trim().length === 0) {
          socket.emit('error', {
            message: 'Invalid room name',
            code: 'INVALID_ROOM_FORMAT'
          });
          return;
        }
        try {
          const channel = await Channel.findOne({
            id: room
          });
          if (!channel) {
            socket.emit('error', {
              message: `Channel '${room}' not found`,
              code: 'CHANNEL_NOT_FOUND'
            });
            return;
          }

          // Leave previous room
          if (socket.room) {
            socket.leave(socket.room);
            this.onlineUsers.set(socket.id, {
              ...this.onlineUsers.get(socket.id),
              room: null
            });
          }
          socket.room = room;
          socket.join(socket.room);
          this.onlineUsers.set(socket.id, {
            ...this.onlineUsers.get(socket.id),
            room: socket.room
          });

          // Send join system message
          const joinMessage = new Message({
            author: 'System',
            channel: socket.room,
            text: `${socket.nickname} joined the channel.`,
            type: 'system'
          });
          await joinMessage.save();
          this.io.to(socket.room).emit('message', {
            author: joinMessage.author,
            channel: joinMessage.channel,
            text: joinMessage.text,
            type: joinMessage.type,
            timestamp: joinMessage.timestamp
          });

          // Send online users
          const roomUsers = Array.from(this.onlineUsers.values()).filter(u => u.room === socket.room).map(u => ({
            nickname: u.nickname,
            role: u.role
          }));
          this.io.to(socket.room).emit('online_users', roomUsers);

          // Send message history
          const history = await Message.find({
            channel: socket.room,
            $or: [{
              type: 'public'
            }, {
              type: 'system'
            }, {
              author: socket.nickname
            }, {
              target: socket.nickname
            }]
          }).sort({
            timestamp: -1
          }).limit(100).sort({
            timestamp: 1
          });
          socket.emit('history', history.map(msg => ({
            author: msg.author,
            room: msg.channel,
            text: msg.text,
            type: msg.type,
            target: msg.target,
            timestamp: msg.timestamp
          })));
        } catch (error) {
          socket.emit('error', {
            message: 'Failed to join room'
          });
        }
      });
      socket.on('message', async data => {
        if (!socket.room || !data.text?.trim()) return;
        try {
          const message = new Message({
            author: socket.nickname,
            channel: socket.room,
            text: data.text.trim(),
            type: 'public'
          });
          await message.save();
          const messageData = {
            author: message.author,
            room: message.channel,
            text: message.text,
            timestamp: message.timestamp,
            status: 'delivered',
            type: message.type
          };
          this.io.to(socket.room).emit('message', messageData);
        } catch (error) {
          socket.emit('error', {
            message: 'Failed to send message'
          });
        }
      });
      socket.on('private_message', async data => {
        const {
          to,
          text
        } = data;
        if (!to || !text?.trim()) return;
        try {
          // Find recipient user
          const recipient = await User.findOne({
            nickname: to
          });
          if (!recipient) {
            socket.emit('error', {
              message: 'Recipient not found'
            });
            return;
          }

          // Create private message
          const privateMessage = new Message({
            author: socket.nickname,
            target: to,
            text: text.trim(),
            type: 'private'
          });
          await privateMessage.save();
          const messageData = {
            author: privateMessage.author,
            text: privateMessage.text,
            target: privateMessage.target,
            timestamp: privateMessage.timestamp,
            type: 'private_message'
          };

          // Send to recipient if online
          const recipientUser = Array.from(this.onlineUsers.values()).find(u => u.nickname === to);
          if (recipientUser) {
            const recipientSocket = Array.from(this.onlineUsers.keys()).find(socketId => this.onlineUsers.get(socketId).nickname === to);
            if (recipientSocket) {
              this.io.to(recipientSocket).emit('private_message', messageData);
            }
          }

          // Send to sender as confirmation
          socket.emit('private_message', messageData);
        } catch (error) {
          socket.emit('error', {
            message: 'Failed to send private message'
          });
        }
      });
      socket.on('speaking', data => {
        socket.to(socket.room).emit('speaking', {
          nickname: socket.nickname,
          speaking: data.speaking
        });
      });
      socket.on('join_voice_channel', async data => {
        const {
          channelId
        } = data;
        if (!channelId) return;
        try {
          const channel = await Channel.findOne({
            id: channelId,
            type: 'voice'
          });
          if (!channel) {
            socket.emit('voice_error', {
              message: 'Voice channel not found'
            });
            return;
          }
          if (!this.voiceChannels.has(channelId)) {
            this.voiceChannels.set(channelId, new Map());
          }
          socket.to(channelId).emit('user_joined_voice', {
            nickname: socket.nickname,
            socketId: socket.id
          });
          socket.join(channelId);
          this.voiceChannels.get(channelId).set(socket.id, {
            peerConnection: null,
            stream: null
          });
          socket.voiceChannel = channelId;
          socket.emit('voice_joined', {
            channelId
          });
        } catch (error) {
          socket.emit('voice_error', {
            message: 'Failed to join voice channel'
          });
        }
      });
      socket.on('leave_voice_channel', () => {
        if (!socket.voiceChannel) return;
        const channelId = socket.voiceChannel;
        const channelPeers = this.voiceChannels.get(channelId);
        if (channelPeers) {
          channelPeers.delete(socket.id);
          if (channelPeers.size === 0) {
            this.voiceChannels.delete(channelId);
          }
        }
        socket.to(channelId).emit('user_left_voice', {
          nickname: socket.nickname,
          socketId: socket.id
        });
        socket.leave(channelId);
        socket.voiceChannel = null;
        socket.emit('voice_left');
      });

      // Voice signaling
      socket.on('voice_offer', data => {
        const {
          offer,
          targetSocketId
        } = data;
        socket.to(targetSocketId).emit('voice_offer', {
          offer,
          from: socket.id,
          fromNickname: socket.nickname
        });
      });
      socket.on('voice_answer', data => {
        const {
          answer,
          targetSocketId
        } = data;
        socket.to(targetSocketId).emit('voice_answer', {
          answer,
          from: socket.id,
          fromNickname: socket.nickname
        });
      });
      socket.on('ice_candidate', data => {
        const {
          candidate,
          targetSocketId
        } = data;
        socket.to(targetSocketId).emit('ice_candidate', {
          candidate,
          from: socket.id,
          fromNickname: socket.nickname
        });
      });
      socket.on('disconnect', async () => {
        // Decrease connection count for this user
        const userId = socket.userId;
        if (userId) {
          const currentCount = this.userConnections.get(userId) || 0;
          const newCount = Math.max(0, currentCount - 1);
          this.userConnections.set(userId, newCount);

          // Update user status in database if this was the last connection
          if (newCount === 0) {
            await User.findByIdAndUpdate(userId, {
              status: 'offline',
              lastActive: new Date()
            });
          }
        }

        // Leave voice channel if in one
        if (socket.voiceChannel) {
          const channelId = socket.voiceChannel;
          const channelPeers = this.voiceChannels.get(channelId);
          if (channelPeers) {
            channelPeers.delete(socket.id);
            if (channelPeers.size === 0) {
              this.voiceChannels.delete(channelId);
            }
          }
          socket.to(channelId).emit('user_left_voice', {
            nickname: socket.nickname,
            socketId: socket.id
          });
        }
        if (socket.room) {
          socket.leave(socket.room);
          const leaveMessage = new Message({
            author: 'System',
            channel: socket.room,
            text: `${socket.nickname} left the channel.`,
            type: 'system'
          });
          await leaveMessage.save();
          this.io.to(socket.room).emit('message', {
            author: leaveMessage.author,
            room: leaveMessage.channel,
            text: leaveMessage.text,
            type: leaveMessage.type,
            timestamp: leaveMessage.timestamp
          });
          const roomUsers = Array.from(this.onlineUsers.values()).filter(u => u.room === socket.room && u.userId !== socket.userId).map(u => ({
            nickname: u.nickname,
            role: u.role
          }));
          this.io.to(socket.room).emit('online_users', roomUsers);
        }
        this.onlineUsers.delete(socket.id);
      });
    });
  }
  async start() {
    console.log(`Starting socket server on port ${this.port}...`);
    return new Promise((resolve, reject) => {
      const timeout = setTimeout(() => {
        reject(new Error('Server startup timeout after 10 seconds'));
      }, 10000);
      this.server.listen(this.port, err => {
        clearTimeout(timeout);
        if (err) {
          console.error('Failed to start socket server:', err.message);
          reject(err);
        } else {
          const assignedPort = this.server.address().port;
          console.log(`Socket server successfully started on port ${assignedPort}`);
          resolve(assignedPort);
        }
      });
    });
  }
  async stop() {
    return new Promise(resolve => {
      this.server.close(() => {
        this.onlineUsers.clear();
        this.voiceChannels.clear();
        resolve();
      });
    });
  }
  getPort() {
    return this.server.address()?.port;
  }
}
module.exports = SocketTestServer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJodHRwIiwicmVxdWlyZSIsInNvY2tldElvIiwiZXhwcmVzcyIsImp3dCIsImNvcnMiLCJjb25uZWN0REIiLCJjbG9zZURCIiwiVXNlciIsIkNoYW5uZWwiLCJNZXNzYWdlIiwiU29ja2V0VGVzdFNlcnZlciIsImNvbnN0cnVjdG9yIiwicG9ydCIsImFwcCIsInNlcnZlciIsImNyZWF0ZVNlcnZlciIsImlvIiwib3JpZ2luIiwibWV0aG9kcyIsIm9ubGluZVVzZXJzIiwiTWFwIiwidm9pY2VDaGFubmVscyIsInVzZXJDb25uZWN0aW9ucyIsInNldHVwRXhwcmVzcyIsInNldHVwU29ja2V0SU8iLCJ1c2UiLCJqc29uIiwicG9zdCIsInJlcSIsInJlcyIsIm5pY2tuYW1lIiwiYm9keSIsInVzZXIiLCJmaW5kT25lIiwic3RhdHVzIiwiZXJyb3IiLCJzYXZlIiwidG9rZW4iLCJzaWduIiwiaWQiLCJfaWQiLCJyb2xlIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJleHBpcmVzSW4iLCJtZXNzYWdlIiwic29ja2V0IiwibmV4dCIsImhhbmRzaGFrZSIsImF1dGgiLCJjb25zb2xlIiwibG9nIiwic3Vic3RyaW5nIiwiRXJyb3IiLCJkZWNvZGVkIiwidmVyaWZ5IiwiZmluZEJ5SWQiLCJ1c2VySWQiLCJjb25uZWN0aW9uQ291bnQiLCJnZXQiLCJuZXdDb25uZWN0aW9uQ291bnQiLCJzZXQiLCJ1cGRhdGVkVXNlciIsImZpbmRPbmVBbmRVcGRhdGUiLCIkc2V0IiwibGFzdEFjdGl2ZSIsIkRhdGUiLCJuZXciLCJydW5WYWxpZGF0b3JzIiwiZXJyIiwib24iLCJyb29tIiwiZGF0YSIsInRyaW0iLCJsZW5ndGgiLCJlbWl0IiwiY29kZSIsImNoYW5uZWwiLCJsZWF2ZSIsImpvaW4iLCJqb2luTWVzc2FnZSIsImF1dGhvciIsInRleHQiLCJ0eXBlIiwidG8iLCJ0aW1lc3RhbXAiLCJyb29tVXNlcnMiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJmaWx0ZXIiLCJ1IiwibWFwIiwiaGlzdG9yeSIsImZpbmQiLCIkb3IiLCJ0YXJnZXQiLCJzb3J0IiwibGltaXQiLCJtc2ciLCJtZXNzYWdlRGF0YSIsInJlY2lwaWVudCIsInByaXZhdGVNZXNzYWdlIiwicmVjaXBpZW50VXNlciIsInJlY2lwaWVudFNvY2tldCIsImtleXMiLCJzb2NrZXRJZCIsInNwZWFraW5nIiwiY2hhbm5lbElkIiwiaGFzIiwicGVlckNvbm5lY3Rpb24iLCJzdHJlYW0iLCJ2b2ljZUNoYW5uZWwiLCJjaGFubmVsUGVlcnMiLCJkZWxldGUiLCJzaXplIiwib2ZmZXIiLCJ0YXJnZXRTb2NrZXRJZCIsImZyb21OaWNrbmFtZSIsImFuc3dlciIsImNhbmRpZGF0ZSIsImN1cnJlbnRDb3VudCIsIm5ld0NvdW50IiwiTWF0aCIsIm1heCIsImZpbmRCeUlkQW5kVXBkYXRlIiwibGVhdmVNZXNzYWdlIiwic3RhcnQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInRpbWVvdXQiLCJzZXRUaW1lb3V0IiwibGlzdGVuIiwiY2xlYXJUaW1lb3V0IiwiYXNzaWduZWRQb3J0IiwiYWRkcmVzcyIsInN0b3AiLCJjbG9zZSIsImNsZWFyIiwiZ2V0UG9ydCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJzb2NrZXQtc2VydmVyLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKTtcbmNvbnN0IHNvY2tldElvID0gcmVxdWlyZSgnc29ja2V0LmlvJyk7XG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XG5jb25zdCBjb3JzID0gcmVxdWlyZSgnY29ycycpO1xuY29uc3QgeyBjb25uZWN0REIsIGNsb3NlREIgfSA9IHJlcXVpcmUoJy4uL2RiL2Nvbm5lY3Rpb24nKTtcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xuY29uc3QgQ2hhbm5lbCA9IHJlcXVpcmUoJy4uL21vZGVscy9DaGFubmVsJyk7XG5jb25zdCBNZXNzYWdlID0gcmVxdWlyZSgnLi4vbW9kZWxzL01lc3NhZ2UnKTtcblxuLy8gVGVzdCBzZXJ2ZXIgZm9yIFNvY2tldC5JTyBpbnRlZ3JhdGlvbiB0ZXN0c1xuY2xhc3MgU29ja2V0VGVzdFNlcnZlciB7XG4gIGNvbnN0cnVjdG9yKHBvcnQgPSAwKSB7IC8vIFVzZSAwIHRvIGdldCByYW5kb20gYXZhaWxhYmxlIHBvcnRcbiAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgIHRoaXMuYXBwID0gZXhwcmVzcygpO1xuICAgIHRoaXMuc2VydmVyID0gaHR0cC5jcmVhdGVTZXJ2ZXIodGhpcy5hcHApO1xuICAgIHRoaXMuaW8gPSBzb2NrZXRJbyh0aGlzLnNlcnZlciwge1xuICAgICAgY29yczoge1xuICAgICAgICBvcmlnaW46IHRydWUsXG4gICAgICAgIG1ldGhvZHM6IFtcIkdFVFwiLCBcIlBPU1RcIl1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMub25saW5lVXNlcnMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy52b2ljZUNoYW5uZWxzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMudXNlckNvbm5lY3Rpb25zID0gbmV3IE1hcCgpOyAvLyBUcmFjayB1c2VyIGNvbm5lY3Rpb24gY291bnRzXG5cbiAgICB0aGlzLnNldHVwRXhwcmVzcygpO1xuICAgIHRoaXMuc2V0dXBTb2NrZXRJTygpO1xuICB9XG5cbiAgc2V0dXBFeHByZXNzKCkge1xuICAgIHRoaXMuYXBwLnVzZShjb3JzKCkpO1xuICAgIHRoaXMuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5cbiAgICAvLyBNaW5pbWFsIGF1dGggcm91dGUgZm9yIGdldHRpbmcgdG9rZW5zXG4gICAgdGhpcy5hcHAucG9zdCgnL3Rlc3QtbG9naW4nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgbmlja25hbWUgfSA9IHJlcS5ib2R5O1xuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgbmlja25hbWUgfSk7XG5cbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdVc2VyIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdXNlciBhcyBvbmxpbmUgZm9yIHNvY2tldCBhdXRoXG4gICAgICAgIHVzZXIuc3RhdHVzID0gJ29ubGluZSc7XG4gICAgICAgIGF3YWl0IHVzZXIuc2F2ZSgpO1xuXG4gICAgICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oXG4gICAgICAgICAgeyBpZDogdXNlci5faWQsIG5pY2tuYW1lOiB1c2VyLm5pY2tuYW1lLCByb2xlOiB1c2VyLnJvbGUgfSxcbiAgICAgICAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVULFxuICAgICAgICAgIHsgZXhwaXJlc0luOiAnMjRoJyB9XG4gICAgICAgICk7XG5cbiAgICAgICAgcmVzLmpzb24oeyB0b2tlbiwgdXNlcjogeyBpZDogdXNlci5faWQsIG5pY2tuYW1lOiB1c2VyLm5pY2tuYW1lLCByb2xlOiB1c2VyLnJvbGUgfSB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZXR1cFNvY2tldElPKCkge1xuICAgIHRoaXMuaW8udXNlKGFzeW5jIChzb2NrZXQsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gc29ja2V0LmhhbmRzaGFrZS5hdXRoLnRva2VuO1xuICAgICAgY29uc29sZS5sb2coJ1NvY2tldC5JTyBhdXRoIG1pZGRsZXdhcmU6IHJlY2VpdmVkIHRva2VuOicsIHRva2VuID8gdG9rZW4uc3Vic3RyaW5nKDAsIDIwKSArICcuLi4nIDogJ251bGwnKTtcblxuICAgICAgaWYgKCF0b2tlbikge1xuICAgICAgICBjb25zb2xlLmxvZygnU29ja2V0LklPIGF1dGggbWlkZGxld2FyZTogbm8gdG9rZW4gcHJvdmlkZWQnKTtcbiAgICAgICAgcmV0dXJuIG5leHQobmV3IEVycm9yKCdBdXRoZW50aWNhdGlvbiB0b2tlbiByZXF1aXJlZCcpKTtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuICAgICAgICBjb25zb2xlLmxvZygnU29ja2V0LklPIGF1dGggbWlkZGxld2FyZTogZGVjb2RlZCB0b2tlbjonLCB7IGlkOiBkZWNvZGVkLmlkLCBuaWNrbmFtZTogZGVjb2RlZC5uaWNrbmFtZSB9KTtcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQoZGVjb2RlZC5pZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdTb2NrZXQuSU8gYXV0aCBtaWRkbGV3YXJlOiB1c2VyIGZvdW5kIGluIERCOicsIHVzZXIgPyB7IGlkOiB1c2VyLl9pZCwgc3RhdHVzOiB1c2VyLnN0YXR1cywgbmlja25hbWU6IHVzZXIubmlja25hbWUgfSA6ICdudWxsJyk7XG5cbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1NvY2tldC5JTyBhdXRoIG1pZGRsZXdhcmU6IEVSUk9SIC0gdXNlciBub3QgZm91bmQgaW4gREInKTtcbiAgICAgICAgICByZXR1cm4gbmV4dChuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kIG9yIG5vdCBvbmxpbmUnKSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZygnU29ja2V0LklPIGF1dGggbWlkZGxld2FyZTogY2hlY2tpbmcgdXNlciBzdGF0dXM6JywgdXNlci5zdGF0dXMpO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgbWFya2VkIGFzIG9mZmxpbmUgZHVyaW5nIGF1dGhlbnRpY2F0aW9uXG4gICAgICAgIGlmICh1c2VyLnN0YXR1cyA9PT0gJ29mZmxpbmUnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1NvY2tldC5JTyBhdXRoIG1pZGRsZXdhcmU6IEVSUk9SIC0gdXNlciBzdGF0dXMgaXMgb2ZmbGluZScpO1xuICAgICAgICAgIHJldHVybiBuZXh0KG5ldyBFcnJvcignVXNlciBub3QgZm91bmQgb3Igbm90IG9ubGluZScpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZSB1c2VyIHN0YXR1cyB1cGRhdGUgYmFzZWQgb24gY29ubmVjdGlvbiBjb3VudFxuICAgICAgICBjb25zdCB1c2VySWQgPSBkZWNvZGVkLmlkO1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uQ291bnQgPSB0aGlzLnVzZXJDb25uZWN0aW9ucy5nZXQodXNlcklkKSB8fCAwO1xuICAgICAgICBjb25zdCBuZXdDb25uZWN0aW9uQ291bnQgPSBjb25uZWN0aW9uQ291bnQgKyAxO1xuICAgICAgICB0aGlzLnVzZXJDb25uZWN0aW9ucy5zZXQodXNlcklkLCBuZXdDb25uZWN0aW9uQ291bnQpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGBTb2NrZXQuSU8gYXV0aCBtaWRkbGV3YXJlOiB1cGRhdGluZyB1c2VyICR7dXNlcklkfSB0byBvbmxpbmUsIGNvbm5lY3Rpb24gY291bnQ6ICR7bmV3Q29ubmVjdGlvbkNvdW50fWApO1xuXG4gICAgICAgIC8vIFVwZGF0ZSB1c2VyIHN0YXR1cyB0byBvbmxpbmUgZHVyaW5nIGF1dGhlbnRpY2F0aW9uXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0gYXdhaXQgVXNlci5maW5kT25lQW5kVXBkYXRlKFxuICAgICAgICAgIHsgX2lkOiB1c2VySWQgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICAkc2V0OiB7XG4gICAgICAgICAgICAgIHN0YXR1czogJ29ubGluZScsXG4gICAgICAgICAgICAgIGxhc3RBY3RpdmU6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgbmV3OiB0cnVlLCBydW5WYWxpZGF0b3JzOiB0cnVlIH1cbiAgICAgICAgKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnU29ja2V0LklPIGF1dGggbWlkZGxld2FyZTogdXNlciB1cGRhdGVkIHRvOicsIHVwZGF0ZWRVc2VyID8geyBpZDogdXBkYXRlZFVzZXIuX2lkLCBzdGF0dXM6IHVwZGF0ZWRVc2VyLnN0YXR1cyB9IDogJ251bGwnKTtcblxuICAgICAgICBzb2NrZXQudXNlcklkID0gZGVjb2RlZC5pZDtcbiAgICAgICAgc29ja2V0Lm5pY2tuYW1lID0gZGVjb2RlZC5uaWNrbmFtZTtcbiAgICAgICAgc29ja2V0LnJvbGUgPSBkZWNvZGVkLnJvbGU7XG4gICAgICAgIGNvbnNvbGUubG9nKCdTb2NrZXQuSU8gYXV0aCBtaWRkbGV3YXJlOiBhdXRoZW50aWNhdGlvbiBzdWNjZXNzZnVsIGZvciB1c2VyOicsIHNvY2tldC5uaWNrbmFtZSk7XG4gICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1NvY2tldC5JTyBhdXRoIG1pZGRsZXdhcmU6IEVSUk9SIGR1cmluZyBhdXRoOicsIGVyci5tZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuIG5leHQobmV3IEVycm9yKCdBdXRoZW50aWNhdGlvbiBmYWlsZWQnKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmlvLm9uKCdjb25uZWN0aW9uJywgKHNvY2tldCkgPT4ge1xuICAgICAgLy8gVHJhY2sgb25saW5lIHVzZXJcbiAgICAgIHRoaXMub25saW5lVXNlcnMuc2V0KHNvY2tldC5pZCwge1xuICAgICAgICB1c2VySWQ6IHNvY2tldC51c2VySWQsXG4gICAgICAgIG5pY2tuYW1lOiBzb2NrZXQubmlja25hbWUsXG4gICAgICAgIHJvbGU6IHNvY2tldC5yb2xlLFxuICAgICAgICByb29tOiBudWxsXG4gICAgICB9KTtcblxuICAgICAgc29ja2V0Lm9uKCdqb2luX3Jvb20nLCBhc3luYyAoZGF0YSkgPT4ge1xuICAgICAgICBjb25zdCB7IHJvb20gfSA9IGRhdGE7XG4gICAgICAgIGlmICghcm9vbSB8fCB0eXBlb2Ygcm9vbSAhPT0gJ3N0cmluZycgfHwgcm9vbS50cmltKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgc29ja2V0LmVtaXQoJ2Vycm9yJywge1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgcm9vbSBuYW1lJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1JPT01fRk9STUFUJ1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgY2hhbm5lbCA9IGF3YWl0IENoYW5uZWwuZmluZE9uZSh7IGlkOiByb29tIH0pO1xuICAgICAgICAgIGlmICghY2hhbm5lbCkge1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2Vycm9yJywge1xuICAgICAgICAgICAgICBtZXNzYWdlOiBgQ2hhbm5lbCAnJHtyb29tfScgbm90IGZvdW5kYCxcbiAgICAgICAgICAgICAgY29kZTogJ0NIQU5ORUxfTk9UX0ZPVU5EJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gTGVhdmUgcHJldmlvdXMgcm9vbVxuICAgICAgICAgIGlmIChzb2NrZXQucm9vbSkge1xuICAgICAgICAgICAgc29ja2V0LmxlYXZlKHNvY2tldC5yb29tKTtcbiAgICAgICAgICAgIHRoaXMub25saW5lVXNlcnMuc2V0KHNvY2tldC5pZCwgeyAuLi50aGlzLm9ubGluZVVzZXJzLmdldChzb2NrZXQuaWQpLCByb29tOiBudWxsIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHNvY2tldC5yb29tID0gcm9vbTtcbiAgICAgICAgICBzb2NrZXQuam9pbihzb2NrZXQucm9vbSk7XG5cbiAgICAgICAgICB0aGlzLm9ubGluZVVzZXJzLnNldChzb2NrZXQuaWQsIHtcbiAgICAgICAgICAgIC4uLnRoaXMub25saW5lVXNlcnMuZ2V0KHNvY2tldC5pZCksXG4gICAgICAgICAgICByb29tOiBzb2NrZXQucm9vbVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2VuZCBqb2luIHN5c3RlbSBtZXNzYWdlXG4gICAgICAgICAgY29uc3Qgam9pbk1lc3NhZ2UgPSBuZXcgTWVzc2FnZSh7XG4gICAgICAgICAgICBhdXRob3I6ICdTeXN0ZW0nLFxuICAgICAgICAgICAgY2hhbm5lbDogc29ja2V0LnJvb20sXG4gICAgICAgICAgICB0ZXh0OiBgJHtzb2NrZXQubmlja25hbWV9IGpvaW5lZCB0aGUgY2hhbm5lbC5gLFxuICAgICAgICAgICAgdHlwZTogJ3N5c3RlbSdcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhd2FpdCBqb2luTWVzc2FnZS5zYXZlKCk7XG5cbiAgICAgICAgICB0aGlzLmlvLnRvKHNvY2tldC5yb29tKS5lbWl0KCdtZXNzYWdlJywge1xuICAgICAgICAgICAgYXV0aG9yOiBqb2luTWVzc2FnZS5hdXRob3IsXG4gICAgICAgICAgICBjaGFubmVsOiBqb2luTWVzc2FnZS5jaGFubmVsLFxuICAgICAgICAgICAgdGV4dDogam9pbk1lc3NhZ2UudGV4dCxcbiAgICAgICAgICAgIHR5cGU6IGpvaW5NZXNzYWdlLnR5cGUsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IGpvaW5NZXNzYWdlLnRpbWVzdGFtcFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2VuZCBvbmxpbmUgdXNlcnNcbiAgICAgICAgICBjb25zdCByb29tVXNlcnMgPSBBcnJheS5mcm9tKHRoaXMub25saW5lVXNlcnMudmFsdWVzKCkpXG4gICAgICAgICAgICAuZmlsdGVyKHUgPT4gdS5yb29tID09PSBzb2NrZXQucm9vbSlcbiAgICAgICAgICAgIC5tYXAodSA9PiAoeyBuaWNrbmFtZTogdS5uaWNrbmFtZSwgcm9sZTogdS5yb2xlIH0pKTtcbiAgICAgICAgICB0aGlzLmlvLnRvKHNvY2tldC5yb29tKS5lbWl0KCdvbmxpbmVfdXNlcnMnLCByb29tVXNlcnMpO1xuXG4gICAgICAgICAgLy8gU2VuZCBtZXNzYWdlIGhpc3RvcnlcbiAgICAgICAgICBjb25zdCBoaXN0b3J5ID0gYXdhaXQgTWVzc2FnZS5maW5kKHtcbiAgICAgICAgICAgIGNoYW5uZWw6IHNvY2tldC5yb29tLFxuICAgICAgICAgICAgJG9yOiBbXG4gICAgICAgICAgICAgIHsgdHlwZTogJ3B1YmxpYycgfSxcbiAgICAgICAgICAgICAgeyB0eXBlOiAnc3lzdGVtJyB9LFxuICAgICAgICAgICAgICB7IGF1dGhvcjogc29ja2V0Lm5pY2tuYW1lIH0sXG4gICAgICAgICAgICAgIHsgdGFyZ2V0OiBzb2NrZXQubmlja25hbWUgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc29ydCh7IHRpbWVzdGFtcDogLTEgfSlcbiAgICAgICAgICAgIC5saW1pdCgxMDApXG4gICAgICAgICAgICAuc29ydCh7IHRpbWVzdGFtcDogMSB9KTtcblxuICAgICAgICAgIHNvY2tldC5lbWl0KCdoaXN0b3J5JywgaGlzdG9yeS5tYXAobXNnID0+ICh7XG4gICAgICAgICAgICBhdXRob3I6IG1zZy5hdXRob3IsXG4gICAgICAgICAgICByb29tOiBtc2cuY2hhbm5lbCxcbiAgICAgICAgICAgIHRleHQ6IG1zZy50ZXh0LFxuICAgICAgICAgICAgdHlwZTogbXNnLnR5cGUsXG4gICAgICAgICAgICB0YXJnZXQ6IG1zZy50YXJnZXQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG1zZy50aW1lc3RhbXBcbiAgICAgICAgICB9KSkpO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgc29ja2V0LmVtaXQoJ2Vycm9yJywgeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGpvaW4gcm9vbScgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBzb2NrZXQub24oJ21lc3NhZ2UnLCBhc3luYyAoZGF0YSkgPT4ge1xuICAgICAgICBpZiAoIXNvY2tldC5yb29tIHx8ICFkYXRhLnRleHQ/LnRyaW0oKSkgcmV0dXJuO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbWVzc2FnZSA9IG5ldyBNZXNzYWdlKHtcbiAgICAgICAgICAgIGF1dGhvcjogc29ja2V0Lm5pY2tuYW1lLFxuICAgICAgICAgICAgY2hhbm5lbDogc29ja2V0LnJvb20sXG4gICAgICAgICAgICB0ZXh0OiBkYXRhLnRleHQudHJpbSgpLFxuICAgICAgICAgICAgdHlwZTogJ3B1YmxpYydcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGF3YWl0IG1lc3NhZ2Uuc2F2ZSgpO1xuXG4gICAgICAgICAgY29uc3QgbWVzc2FnZURhdGEgPSB7XG4gICAgICAgICAgICBhdXRob3I6IG1lc3NhZ2UuYXV0aG9yLFxuICAgICAgICAgICAgcm9vbTogbWVzc2FnZS5jaGFubmVsLFxuICAgICAgICAgICAgdGV4dDogbWVzc2FnZS50ZXh0LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBtZXNzYWdlLnRpbWVzdGFtcCxcbiAgICAgICAgICAgIHN0YXR1czogJ2RlbGl2ZXJlZCcsXG4gICAgICAgICAgICB0eXBlOiBtZXNzYWdlLnR5cGVcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgdGhpcy5pby50byhzb2NrZXQucm9vbSkuZW1pdCgnbWVzc2FnZScsIG1lc3NhZ2VEYXRhKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBzb2NrZXQuZW1pdCgnZXJyb3InLCB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2VuZCBtZXNzYWdlJyB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHNvY2tldC5vbigncHJpdmF0ZV9tZXNzYWdlJywgYXN5bmMgKGRhdGEpID0+IHtcbiAgICAgICAgY29uc3QgeyB0bywgdGV4dCB9ID0gZGF0YTtcbiAgICAgICAgaWYgKCF0byB8fCAhdGV4dD8udHJpbSgpKSByZXR1cm47XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBGaW5kIHJlY2lwaWVudCB1c2VyXG4gICAgICAgICAgY29uc3QgcmVjaXBpZW50ID0gYXdhaXQgVXNlci5maW5kT25lKHsgbmlja25hbWU6IHRvIH0pO1xuICAgICAgICAgIGlmICghcmVjaXBpZW50KSB7XG4gICAgICAgICAgICBzb2NrZXQuZW1pdCgnZXJyb3InLCB7IG1lc3NhZ2U6ICdSZWNpcGllbnQgbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBDcmVhdGUgcHJpdmF0ZSBtZXNzYWdlXG4gICAgICAgICAgY29uc3QgcHJpdmF0ZU1lc3NhZ2UgPSBuZXcgTWVzc2FnZSh7XG4gICAgICAgICAgICBhdXRob3I6IHNvY2tldC5uaWNrbmFtZSxcbiAgICAgICAgICAgIHRhcmdldDogdG8sXG4gICAgICAgICAgICB0ZXh0OiB0ZXh0LnRyaW0oKSxcbiAgICAgICAgICAgIHR5cGU6ICdwcml2YXRlJ1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgYXdhaXQgcHJpdmF0ZU1lc3NhZ2Uuc2F2ZSgpO1xuXG4gICAgICAgICAgY29uc3QgbWVzc2FnZURhdGEgPSB7XG4gICAgICAgICAgICBhdXRob3I6IHByaXZhdGVNZXNzYWdlLmF1dGhvcixcbiAgICAgICAgICAgIHRleHQ6IHByaXZhdGVNZXNzYWdlLnRleHQsXG4gICAgICAgICAgICB0YXJnZXQ6IHByaXZhdGVNZXNzYWdlLnRhcmdldCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogcHJpdmF0ZU1lc3NhZ2UudGltZXN0YW1wLFxuICAgICAgICAgICAgdHlwZTogJ3ByaXZhdGVfbWVzc2FnZSdcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgLy8gU2VuZCB0byByZWNpcGllbnQgaWYgb25saW5lXG4gICAgICAgICAgY29uc3QgcmVjaXBpZW50VXNlciA9IEFycmF5LmZyb20odGhpcy5vbmxpbmVVc2Vycy52YWx1ZXMoKSkuZmluZCh1ID0+IHUubmlja25hbWUgPT09IHRvKTtcbiAgICAgICAgICBpZiAocmVjaXBpZW50VXNlcikge1xuICAgICAgICAgICAgY29uc3QgcmVjaXBpZW50U29ja2V0ID0gQXJyYXkuZnJvbSh0aGlzLm9ubGluZVVzZXJzLmtleXMoKSkuZmluZChzb2NrZXRJZCA9PlxuICAgICAgICAgICAgICB0aGlzLm9ubGluZVVzZXJzLmdldChzb2NrZXRJZCkubmlja25hbWUgPT09IHRvXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHJlY2lwaWVudFNvY2tldCkge1xuICAgICAgICAgICAgICB0aGlzLmlvLnRvKHJlY2lwaWVudFNvY2tldCkuZW1pdCgncHJpdmF0ZV9tZXNzYWdlJywgbWVzc2FnZURhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFNlbmQgdG8gc2VuZGVyIGFzIGNvbmZpcm1hdGlvblxuICAgICAgICAgIHNvY2tldC5lbWl0KCdwcml2YXRlX21lc3NhZ2UnLCBtZXNzYWdlRGF0YSk7XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBzb2NrZXQuZW1pdCgnZXJyb3InLCB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2VuZCBwcml2YXRlIG1lc3NhZ2UnIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgc29ja2V0Lm9uKCdzcGVha2luZycsIChkYXRhKSA9PiB7XG4gICAgICAgIHNvY2tldC50byhzb2NrZXQucm9vbSkuZW1pdCgnc3BlYWtpbmcnLCB7XG4gICAgICAgICAgbmlja25hbWU6IHNvY2tldC5uaWNrbmFtZSxcbiAgICAgICAgICBzcGVha2luZzogZGF0YS5zcGVha2luZ1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBzb2NrZXQub24oJ2pvaW5fdm9pY2VfY2hhbm5lbCcsIGFzeW5jIChkYXRhKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgY2hhbm5lbElkIH0gPSBkYXRhO1xuICAgICAgICBpZiAoIWNoYW5uZWxJZCkgcmV0dXJuO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgY2hhbm5lbCA9IGF3YWl0IENoYW5uZWwuZmluZE9uZSh7IGlkOiBjaGFubmVsSWQsIHR5cGU6ICd2b2ljZScgfSk7XG4gICAgICAgICAgaWYgKCFjaGFubmVsKSB7XG4gICAgICAgICAgICBzb2NrZXQuZW1pdCgndm9pY2VfZXJyb3InLCB7IG1lc3NhZ2U6ICdWb2ljZSBjaGFubmVsIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKCF0aGlzLnZvaWNlQ2hhbm5lbHMuaGFzKGNoYW5uZWxJZCkpIHtcbiAgICAgICAgICAgIHRoaXMudm9pY2VDaGFubmVscy5zZXQoY2hhbm5lbElkLCBuZXcgTWFwKCkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHNvY2tldC50byhjaGFubmVsSWQpLmVtaXQoJ3VzZXJfam9pbmVkX3ZvaWNlJywge1xuICAgICAgICAgICAgbmlja25hbWU6IHNvY2tldC5uaWNrbmFtZSxcbiAgICAgICAgICAgIHNvY2tldElkOiBzb2NrZXQuaWRcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHNvY2tldC5qb2luKGNoYW5uZWxJZCk7XG4gICAgICAgICAgdGhpcy52b2ljZUNoYW5uZWxzLmdldChjaGFubmVsSWQpLnNldChzb2NrZXQuaWQsIHsgcGVlckNvbm5lY3Rpb246IG51bGwsIHN0cmVhbTogbnVsbCB9KTtcblxuICAgICAgICAgIHNvY2tldC52b2ljZUNoYW5uZWwgPSBjaGFubmVsSWQ7XG4gICAgICAgICAgc29ja2V0LmVtaXQoJ3ZvaWNlX2pvaW5lZCcsIHsgY2hhbm5lbElkIH0pO1xuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgc29ja2V0LmVtaXQoJ3ZvaWNlX2Vycm9yJywgeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGpvaW4gdm9pY2UgY2hhbm5lbCcgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBzb2NrZXQub24oJ2xlYXZlX3ZvaWNlX2NoYW5uZWwnLCAoKSA9PiB7XG4gICAgICAgIGlmICghc29ja2V0LnZvaWNlQ2hhbm5lbCkgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IGNoYW5uZWxJZCA9IHNvY2tldC52b2ljZUNoYW5uZWw7XG4gICAgICAgIGNvbnN0IGNoYW5uZWxQZWVycyA9IHRoaXMudm9pY2VDaGFubmVscy5nZXQoY2hhbm5lbElkKTtcblxuICAgICAgICBpZiAoY2hhbm5lbFBlZXJzKSB7XG4gICAgICAgICAgY2hhbm5lbFBlZXJzLmRlbGV0ZShzb2NrZXQuaWQpO1xuICAgICAgICAgIGlmIChjaGFubmVsUGVlcnMuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy52b2ljZUNoYW5uZWxzLmRlbGV0ZShjaGFubmVsSWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHNvY2tldC50byhjaGFubmVsSWQpLmVtaXQoJ3VzZXJfbGVmdF92b2ljZScsIHtcbiAgICAgICAgICBuaWNrbmFtZTogc29ja2V0Lm5pY2tuYW1lLFxuICAgICAgICAgIHNvY2tldElkOiBzb2NrZXQuaWRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0LmxlYXZlKGNoYW5uZWxJZCk7XG4gICAgICAgIHNvY2tldC52b2ljZUNoYW5uZWwgPSBudWxsO1xuICAgICAgICBzb2NrZXQuZW1pdCgndm9pY2VfbGVmdCcpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFZvaWNlIHNpZ25hbGluZ1xuICAgICAgc29ja2V0Lm9uKCd2b2ljZV9vZmZlcicsIChkYXRhKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb2ZmZXIsIHRhcmdldFNvY2tldElkIH0gPSBkYXRhO1xuICAgICAgICBzb2NrZXQudG8odGFyZ2V0U29ja2V0SWQpLmVtaXQoJ3ZvaWNlX29mZmVyJywge1xuICAgICAgICAgIG9mZmVyLFxuICAgICAgICAgIGZyb206IHNvY2tldC5pZCxcbiAgICAgICAgICBmcm9tTmlja25hbWU6IHNvY2tldC5uaWNrbmFtZVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBzb2NrZXQub24oJ3ZvaWNlX2Fuc3dlcicsIChkYXRhKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgYW5zd2VyLCB0YXJnZXRTb2NrZXRJZCB9ID0gZGF0YTtcbiAgICAgICAgc29ja2V0LnRvKHRhcmdldFNvY2tldElkKS5lbWl0KCd2b2ljZV9hbnN3ZXInLCB7XG4gICAgICAgICAgYW5zd2VyLFxuICAgICAgICAgIGZyb206IHNvY2tldC5pZCxcbiAgICAgICAgICBmcm9tTmlja25hbWU6IHNvY2tldC5uaWNrbmFtZVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBzb2NrZXQub24oJ2ljZV9jYW5kaWRhdGUnLCAoZGF0YSkgPT4ge1xuICAgICAgICBjb25zdCB7IGNhbmRpZGF0ZSwgdGFyZ2V0U29ja2V0SWQgfSA9IGRhdGE7XG4gICAgICAgIHNvY2tldC50byh0YXJnZXRTb2NrZXRJZCkuZW1pdCgnaWNlX2NhbmRpZGF0ZScsIHtcbiAgICAgICAgICBjYW5kaWRhdGUsXG4gICAgICAgICAgZnJvbTogc29ja2V0LmlkLFxuICAgICAgICAgIGZyb21OaWNrbmFtZTogc29ja2V0Lm5pY2tuYW1lXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHNvY2tldC5vbignZGlzY29ubmVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gRGVjcmVhc2UgY29ubmVjdGlvbiBjb3VudCBmb3IgdGhpcyB1c2VyXG4gICAgICAgIGNvbnN0IHVzZXJJZCA9IHNvY2tldC51c2VySWQ7XG4gICAgICAgIGlmICh1c2VySWQpIHtcbiAgICAgICAgICBjb25zdCBjdXJyZW50Q291bnQgPSB0aGlzLnVzZXJDb25uZWN0aW9ucy5nZXQodXNlcklkKSB8fCAwO1xuICAgICAgICAgIGNvbnN0IG5ld0NvdW50ID0gTWF0aC5tYXgoMCwgY3VycmVudENvdW50IC0gMSk7XG4gICAgICAgICAgdGhpcy51c2VyQ29ubmVjdGlvbnMuc2V0KHVzZXJJZCwgbmV3Q291bnQpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHVzZXIgc3RhdHVzIGluIGRhdGFiYXNlIGlmIHRoaXMgd2FzIHRoZSBsYXN0IGNvbm5lY3Rpb25cbiAgICAgICAgICBpZiAobmV3Q291bnQgPT09IDApIHtcbiAgICAgICAgICAgIGF3YWl0IFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUodXNlcklkLCB7XG4gICAgICAgICAgICAgIHN0YXR1czogJ29mZmxpbmUnLFxuICAgICAgICAgICAgICBsYXN0QWN0aXZlOiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBMZWF2ZSB2b2ljZSBjaGFubmVsIGlmIGluIG9uZVxuICAgICAgICBpZiAoc29ja2V0LnZvaWNlQ2hhbm5lbCkge1xuICAgICAgICAgIGNvbnN0IGNoYW5uZWxJZCA9IHNvY2tldC52b2ljZUNoYW5uZWw7XG4gICAgICAgICAgY29uc3QgY2hhbm5lbFBlZXJzID0gdGhpcy52b2ljZUNoYW5uZWxzLmdldChjaGFubmVsSWQpO1xuXG4gICAgICAgICAgaWYgKGNoYW5uZWxQZWVycykge1xuICAgICAgICAgICAgY2hhbm5lbFBlZXJzLmRlbGV0ZShzb2NrZXQuaWQpO1xuICAgICAgICAgICAgaWYgKGNoYW5uZWxQZWVycy5zaXplID09PSAwKSB7XG4gICAgICAgICAgICAgIHRoaXMudm9pY2VDaGFubmVscy5kZWxldGUoY2hhbm5lbElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzb2NrZXQudG8oY2hhbm5lbElkKS5lbWl0KCd1c2VyX2xlZnRfdm9pY2UnLCB7XG4gICAgICAgICAgICBuaWNrbmFtZTogc29ja2V0Lm5pY2tuYW1lLFxuICAgICAgICAgICAgc29ja2V0SWQ6IHNvY2tldC5pZFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNvY2tldC5yb29tKSB7XG4gICAgICAgICAgc29ja2V0LmxlYXZlKHNvY2tldC5yb29tKTtcblxuICAgICAgICAgIGNvbnN0IGxlYXZlTWVzc2FnZSA9IG5ldyBNZXNzYWdlKHtcbiAgICAgICAgICAgIGF1dGhvcjogJ1N5c3RlbScsXG4gICAgICAgICAgICBjaGFubmVsOiBzb2NrZXQucm9vbSxcbiAgICAgICAgICAgIHRleHQ6IGAke3NvY2tldC5uaWNrbmFtZX0gbGVmdCB0aGUgY2hhbm5lbC5gLFxuICAgICAgICAgICAgdHlwZTogJ3N5c3RlbSdcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhd2FpdCBsZWF2ZU1lc3NhZ2Uuc2F2ZSgpO1xuXG4gICAgICAgICAgdGhpcy5pby50byhzb2NrZXQucm9vbSkuZW1pdCgnbWVzc2FnZScsIHtcbiAgICAgICAgICAgIGF1dGhvcjogbGVhdmVNZXNzYWdlLmF1dGhvcixcbiAgICAgICAgICAgIHJvb206IGxlYXZlTWVzc2FnZS5jaGFubmVsLFxuICAgICAgICAgICAgdGV4dDogbGVhdmVNZXNzYWdlLnRleHQsXG4gICAgICAgICAgICB0eXBlOiBsZWF2ZU1lc3NhZ2UudHlwZSxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbGVhdmVNZXNzYWdlLnRpbWVzdGFtcFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3Qgcm9vbVVzZXJzID0gQXJyYXkuZnJvbSh0aGlzLm9ubGluZVVzZXJzLnZhbHVlcygpKVxuICAgICAgICAgICAgLmZpbHRlcih1ID0+IHUucm9vbSA9PT0gc29ja2V0LnJvb20gJiYgdS51c2VySWQgIT09IHNvY2tldC51c2VySWQpXG4gICAgICAgICAgICAubWFwKHUgPT4gKHsgbmlja25hbWU6IHUubmlja25hbWUsIHJvbGU6IHUucm9sZSB9KSk7XG4gICAgICAgICAgdGhpcy5pby50byhzb2NrZXQucm9vbSkuZW1pdCgnb25saW5lX3VzZXJzJywgcm9vbVVzZXJzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub25saW5lVXNlcnMuZGVsZXRlKHNvY2tldC5pZCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0KCkge1xuICAgIGNvbnNvbGUubG9nKGBTdGFydGluZyBzb2NrZXQgc2VydmVyIG9uIHBvcnQgJHt0aGlzLnBvcnR9Li4uYCk7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignU2VydmVyIHN0YXJ0dXAgdGltZW91dCBhZnRlciAxMCBzZWNvbmRzJykpO1xuICAgICAgfSwgMTAwMDApO1xuXG4gICAgICB0aGlzLnNlcnZlci5saXN0ZW4odGhpcy5wb3J0LCAoZXJyKSA9PiB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzdGFydCBzb2NrZXQgc2VydmVyOicsIGVyci5tZXNzYWdlKTtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBhc3NpZ25lZFBvcnQgPSB0aGlzLnNlcnZlci5hZGRyZXNzKCkucG9ydDtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgU29ja2V0IHNlcnZlciBzdWNjZXNzZnVsbHkgc3RhcnRlZCBvbiBwb3J0ICR7YXNzaWduZWRQb3J0fWApO1xuICAgICAgICAgIHJlc29sdmUoYXNzaWduZWRQb3J0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdG9wKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdGhpcy5zZXJ2ZXIuY2xvc2UoKCkgPT4ge1xuICAgICAgICB0aGlzLm9ubGluZVVzZXJzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMudm9pY2VDaGFubmVscy5jbGVhcigpO1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFBvcnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VydmVyLmFkZHJlc3MoKT8ucG9ydDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFNvY2tldFRlc3RTZXJ2ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFDNUIsTUFBTUMsUUFBUSxHQUFHRCxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQ3JDLE1BQU1FLE9BQU8sR0FBR0YsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNRyxHQUFHLEdBQUdILE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDbkMsTUFBTUksSUFBSSxHQUFHSixPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzVCLE1BQU07RUFBRUssU0FBUztFQUFFQztBQUFRLENBQUMsR0FBR04sT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBQzFELE1BQU1PLElBQUksR0FBR1AsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU1RLE9BQU8sR0FBR1IsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzVDLE1BQU1TLE9BQU8sR0FBR1QsT0FBTyxDQUFDLG1CQUFtQixDQUFDOztBQUU1QztBQUNBLE1BQU1VLGdCQUFnQixDQUFDO0VBQ3JCQyxXQUFXQSxDQUFDQyxJQUFJLEdBQUcsQ0FBQyxFQUFFO0lBQUU7SUFDdEIsSUFBSSxDQUFDQSxJQUFJLEdBQUdBLElBQUk7SUFDaEIsSUFBSSxDQUFDQyxHQUFHLEdBQUdYLE9BQU8sQ0FBQyxDQUFDO0lBQ3BCLElBQUksQ0FBQ1ksTUFBTSxHQUFHZixJQUFJLENBQUNnQixZQUFZLENBQUMsSUFBSSxDQUFDRixHQUFHLENBQUM7SUFDekMsSUFBSSxDQUFDRyxFQUFFLEdBQUdmLFFBQVEs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