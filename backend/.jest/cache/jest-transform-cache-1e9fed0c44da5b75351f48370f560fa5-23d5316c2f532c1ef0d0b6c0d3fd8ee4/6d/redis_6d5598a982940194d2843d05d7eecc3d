6fc25e0d978d09f70c3db4c68a2d672a
const Redis = require('ioredis');
const config = require('./index');
const winston = require('winston');
class RedisManager {
  constructor() {
    this.client = null;
    this.isConnected = false;
    this.memoryCheckInterval = null;
    this.logger = winston.createLogger({
      level: 'info',
      format: winston.format.json(),
      transports: [new winston.transports.Console({
        format: winston.format.simple()
      })]
    });
  }
  async connect() {
    try {
      if (config.redis.enableCluster) {
        this.client = new Redis.Cluster([{
          host: config.redis.host,
          port: config.redis.port,
          password: config.redis.password,
          db: config.redis.db
        }], {
          redisOptions: {
            keyPrefix: config.redis.keyPrefix,
            connectTimeout: config.redis.connectTimeout,
            commandTimeout: config.redis.commandTimeout,
            maxRetriesPerRequest: config.redis.maxRetriesPerRequest,
            retryDelayOnFailover: config.redis.retryDelayOnFailover
          },
          clusterOptions: config.redis.cluster
        });
      } else {
        this.client = new Redis({
          host: config.redis.host,
          port: config.redis.port,
          password: config.redis.password,
          db: config.redis.db,
          keyPrefix: config.redis.keyPrefix,
          connectTimeout: config.redis.connectTimeout,
          commandTimeout: config.redis.commandTimeout,
          maxRetriesPerRequest: config.redis.maxRetriesPerRequest,
          retryDelayOnFailover: config.redis.retryDelayOnFailover
        });
      }
      this.client.on('connect', () => {
        this.isConnected = true;
        this.logger.info('Redis connected successfully');
      });
      this.client.on('error', error => {
        this.logger.error('Redis connection error:', error.message);
        this.isConnected = false;
      });
      this.client.on('ready', () => {
        this.logger.info('Redis client ready');
        this.startMemoryMonitoring();
      });
      this.client.on('close', () => {
        this.logger.info('Redis connection closed');
        this.isConnected = false;
        this.stopMemoryMonitoring();
      });

      // Wait for connection
      await this.client.ping();
      return this.client;
    } catch (error) {
      this.logger.error('Failed to connect to Redis:', error.message);
      throw error;
    }
  }
  async disconnect() {
    if (this.client) {
      this.stopMemoryMonitoring();
      await this.client.quit();
      this.isConnected = false;
      this.logger.info('Redis connection closed');
    }
  }
  getClient() {
    return this.client;
  }
  isClientReady() {
    return this.client && this.isConnected;
  }
  startMemoryMonitoring() {
    if (!config.redis.memoryMonitoring.enabled) {
      return;
    }
    this.memoryCheckInterval = setInterval(async () => {
      try {
        if (!this.isClientReady()) {
          return;
        }
        const memoryInfo = await this.client.info('memory');
        const usedMemory = parseInt(memoryInfo.split('\n').find(line => line.startsWith('used_memory:')).split(':')[1]);
        const maxMemory = await this.client.config('GET', 'maxmemory');
        if (maxMemory && maxMemory[1] !== '0') {
          const memoryPercentage = usedMemory / parseInt(maxMemory[1]);
          if (memoryPercentage >= config.redis.memoryMonitoring.thresholds.critical) {
            this.logger.error(`Redis memory usage critical: ${(memoryPercentage * 100).toFixed(2)}%`);
            // Trigger critical memory handling
            await this.handleMemoryPressure(true);
          } else if (memoryPercentage >= config.redis.memoryMonitoring.thresholds.warning) {
            this.logger.warn(`Redis memory usage high: ${(memoryPercentage * 100).toFixed(2)}%`);
            // Trigger warning memory handling
            await this.handleMemoryPressure(false);
          }
        }
      } catch (error) {
        this.logger.error('Error monitoring Redis memory:', error.message);
      }
    }, config.redis.memoryMonitoring.checkInterval);
  }
  stopMemoryMonitoring() {
    if (this.memoryCheckInterval) {
      clearInterval(this.memoryCheckInterval);
      this.memoryCheckInterval = null;
    }
  }
  async handleMemoryPressure(isCritical) {
    try {
      // Implement memory pressure handling logic
      if (isCritical) {
        // Aggressive cache cleanup
        await this.client.keys(`${config.redis.cachePrefix}*`).then(keys => {
          if (keys.length > 0) {
            return this.client.del(keys);
          }
        });

        // Expire old sessions
        await this.client.keys(`${config.redis.sessionPrefix}*`).then(async keys => {
          for (const key of keys) {
            const ttl = await this.client.ttl(key);
            if (ttl === -1 || ttl > 36000) {
              // Sessions older than 10 hours
              await this.client.expire(key, 3600); // Set to 1 hour
            }
          }
        });
      } else {
        // Normal cleanup - remove expired cache items
        await this.client.keys(`${config.redis.cachePrefix}*`).then(async keys => {
          for (const key of keys) {
            const ttl = await this.client.ttl(key);
            if (ttl === -2) {
              // Expired keys
              await this.client.del(key);
            }
          }
        });
      }
      this.logger.info(`Memory pressure handling completed (critical: ${isCritical})`);
    } catch (error) {
      this.logger.error('Error handling memory pressure:', error.message);
    }
  }

  // Helper methods for common Redis operations
  async setSession(sessionId, data, ttl = config.redis.sessionTTL) {
    if (!this.isClientReady()) {
      throw new Error('Redis client not ready');
    }
    const key = `${config.redis.sessionPrefix}${sessionId}`;
    await this.client.set(key, JSON.stringify(data), 'EX', ttl);
  }
  async getSession(sessionId) {
    if (!this.isClientReady()) {
      return null;
    }
    const key = `${config.redis.sessionPrefix}${sessionId}`;
    const data = await this.client.get(key);
    return data ? JSON.parse(data) : null;
  }
  async deleteSession(sessionId) {
    if (!this.isClientReady()) {
      return;
    }
    const key = `${config.redis.sessionPrefix}${sessionId}`;
    await this.client.del(key);
  }
  async setCache(key, data, ttl = config.redis.cacheTTL) {
    if (!this.isClientReady()) {
      throw new Error('Redis client not ready');
    }
    const cacheKey = `${config.redis.cachePrefix}${key}`;
    await this.client.set(cacheKey, JSON.stringify(data), 'EX', ttl);
  }
  async getCache(key) {
    if (!this.isClientReady()) {
      return null;
    }
    const cacheKey = `${config.redis.cachePrefix}${key}`;
    const data = await this.client.get(cacheKey);
    return data ? JSON.parse(data) : null;
  }
  async deleteCache(key) {
    if (!this.isClientReady()) {
      return;
    }
    const cacheKey = `${config.redis.cachePrefix}${key}`;
    await this.client.del(cacheKey);
  }
  async clearCache(pattern) {
    if (!this.isClientReady()) {
      return;
    }
    const cacheKeyPattern = `${config.redis.cachePrefix}${pattern}`;
    const keys = await this.client.keys(cacheKeyPattern);
    if (keys.length > 0) {
      await this.client.del(keys);
    }
  }
}

// Export a singleton instance
const redisManager = new RedisManager();
module.exports = {
  redisManager,
  client: () => redisManager.getClient(),
  connect: () => redisManager.connect(),
  disconnect: () => redisManager.disconnect(),
  isReady: () => redisManager.isClientReady(),
  // Convenience exports for common operations
  setSession: (sessionId, data, ttl) => redisManager.setSession(sessionId, data, ttl),
  getSession: sessionId => redisManager.getSession(sessionId),
  deleteSession: sessionId => redisManager.deleteSession(sessionId),
  setCache: (key, data, ttl) => redisManager.setCache(key, data, ttl),
  getCache: key => redisManager.getCache(key),
  deleteCache: key => redisManager.deleteCache(key),
  clearCache: pattern => redisManager.clearCache(pattern)
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWRpcyIsInJlcXVpcmUiLCJjb25maWciLCJ3aW5zdG9uIiwiUmVkaXNNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJjbGllbnQiLCJpc0Nvbm5lY3RlZCIsIm1lbW9yeUNoZWNrSW50ZXJ2YWwiLCJsb2dnZXIiLCJjcmVhdGVMb2dnZXIiLCJsZXZlbCIsImZvcm1hdCIsImpzb24iLCJ0cmFuc3BvcnRzIiwiQ29uc29sZSIsInNpbXBsZSIsImNvbm5lY3QiLCJyZWRpcyIsImVuYWJsZUNsdXN0ZXIiLCJDbHVzdGVyIiwiaG9zdCIsInBvcnQiLCJwYXNzd29yZCIsImRiIiwicmVkaXNPcHRpb25zIiwia2V5UHJlZml4IiwiY29ubmVjdFRpbWVvdXQiLCJjb21tYW5kVGltZW91dCIsIm1heFJldHJpZXNQZXJSZXF1ZXN0IiwicmV0cnlEZWxheU9uRmFpbG92ZXIiLCJjbHVzdGVyT3B0aW9ucyIsImNsdXN0ZXIiLCJvbiIsImluZm8iLCJlcnJvciIsIm1lc3NhZ2UiLCJzdGFydE1lbW9yeU1vbml0b3JpbmciLCJzdG9wTWVtb3J5TW9uaXRvcmluZyIsInBpbmciLCJkaXNjb25uZWN0IiwicXVpdCIsImdldENsaWVudCIsImlzQ2xpZW50UmVhZHkiLCJtZW1vcnlNb25pdG9yaW5nIiwiZW5hYmxlZCIsInNldEludGVydmFsIiwibWVtb3J5SW5mbyIsInVzZWRNZW1vcnkiLCJwYXJzZUludCIsInNwbGl0IiwiZmluZCIsImxpbmUiLCJzdGFydHNXaXRoIiwibWF4TWVtb3J5IiwibWVtb3J5UGVyY2VudGFnZSIsInRocmVzaG9sZHMiLCJjcml0aWNhbCIsInRvRml4ZWQiLCJoYW5kbGVNZW1vcnlQcmVzc3VyZSIsIndhcm5pbmciLCJ3YXJuIiwiY2hlY2tJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJpc0NyaXRpY2FsIiwia2V5cyIsImNhY2hlUHJlZml4IiwidGhlbiIsImxlbmd0aCIsImRlbCIsInNlc3Npb25QcmVmaXgiLCJrZXkiLCJ0dGwiLCJleHBpcmUiLCJzZXRTZXNzaW9uIiwic2Vzc2lvbklkIiwiZGF0YSIsInNlc3Npb25UVEwiLCJFcnJvciIsInNldCIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRTZXNzaW9uIiwiZ2V0IiwicGFyc2UiLCJkZWxldGVTZXNzaW9uIiwic2V0Q2FjaGUiLCJjYWNoZVRUTCIsImNhY2hlS2V5IiwiZ2V0Q2FjaGUiLCJkZWxldGVDYWNoZSIsImNsZWFyQ2FjaGUiLCJwYXR0ZXJuIiwiY2FjaGVLZXlQYXR0ZXJuIiwicmVkaXNNYW5hZ2VyIiwibW9kdWxlIiwiZXhwb3J0cyIsImlzUmVhZHkiXSwic291cmNlcyI6WyJyZWRpcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBSZWRpcyA9IHJlcXVpcmUoJ2lvcmVkaXMnKTtcbmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoJy4vaW5kZXgnKTtcbmNvbnN0IHdpbnN0b24gPSByZXF1aXJlKCd3aW5zdG9uJyk7XG5cbmNsYXNzIFJlZGlzTWFuYWdlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY2xpZW50ID0gbnVsbDtcbiAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5tZW1vcnlDaGVja0ludGVydmFsID0gbnVsbDtcbiAgICB0aGlzLmxvZ2dlciA9IHdpbnN0b24uY3JlYXRlTG9nZ2VyKHtcbiAgICAgIGxldmVsOiAnaW5mbycsXG4gICAgICBmb3JtYXQ6IHdpbnN0b24uZm9ybWF0Lmpzb24oKSxcbiAgICAgIHRyYW5zcG9ydHM6IFtcbiAgICAgICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKHtcbiAgICAgICAgICBmb3JtYXQ6IHdpbnN0b24uZm9ybWF0LnNpbXBsZSgpXG4gICAgICAgIH0pXG4gICAgICBdXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBjb25uZWN0KCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAoY29uZmlnLnJlZGlzLmVuYWJsZUNsdXN0ZXIpIHtcbiAgICAgICAgdGhpcy5jbGllbnQgPSBuZXcgUmVkaXMuQ2x1c3RlcihbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaG9zdDogY29uZmlnLnJlZGlzLmhvc3QsXG4gICAgICAgICAgICBwb3J0OiBjb25maWcucmVkaXMucG9ydCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBjb25maWcucmVkaXMucGFzc3dvcmQsXG4gICAgICAgICAgICBkYjogY29uZmlnLnJlZGlzLmRiXG4gICAgICAgICAgfVxuICAgICAgICBdLCB7XG4gICAgICAgICAgcmVkaXNPcHRpb25zOiB7XG4gICAgICAgICAgICBrZXlQcmVmaXg6IGNvbmZpZy5yZWRpcy5rZXlQcmVmaXgsXG4gICAgICAgICAgICBjb25uZWN0VGltZW91dDogY29uZmlnLnJlZGlzLmNvbm5lY3RUaW1lb3V0LFxuICAgICAgICAgICAgY29tbWFuZFRpbWVvdXQ6IGNvbmZpZy5yZWRpcy5jb21tYW5kVGltZW91dCxcbiAgICAgICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiBjb25maWcucmVkaXMubWF4UmV0cmllc1BlclJlcXVlc3QsXG4gICAgICAgICAgICByZXRyeURlbGF5T25GYWlsb3ZlcjogY29uZmlnLnJlZGlzLnJldHJ5RGVsYXlPbkZhaWxvdmVyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbHVzdGVyT3B0aW9uczogY29uZmlnLnJlZGlzLmNsdXN0ZXJcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNsaWVudCA9IG5ldyBSZWRpcyh7XG4gICAgICAgICAgaG9zdDogY29uZmlnLnJlZGlzLmhvc3QsXG4gICAgICAgICAgcG9ydDogY29uZmlnLnJlZGlzLnBvcnQsXG4gICAgICAgICAgcGFzc3dvcmQ6IGNvbmZpZy5yZWRpcy5wYXNzd29yZCxcbiAgICAgICAgICBkYjogY29uZmlnLnJlZGlzLmRiLFxuICAgICAgICAgIGtleVByZWZpeDogY29uZmlnLnJlZGlzLmtleVByZWZpeCxcbiAgICAgICAgICBjb25uZWN0VGltZW91dDogY29uZmlnLnJlZGlzLmNvbm5lY3RUaW1lb3V0LFxuICAgICAgICAgIGNvbW1hbmRUaW1lb3V0OiBjb25maWcucmVkaXMuY29tbWFuZFRpbWVvdXQsXG4gICAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IGNvbmZpZy5yZWRpcy5tYXhSZXRyaWVzUGVyUmVxdWVzdCxcbiAgICAgICAgICByZXRyeURlbGF5T25GYWlsb3ZlcjogY29uZmlnLnJlZGlzLnJldHJ5RGVsYXlPbkZhaWxvdmVyXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNsaWVudC5vbignY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IHRydWU7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ1JlZGlzIGNvbm5lY3RlZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbignZXJyb3InLCAoZXJyb3IpID0+IHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ1JlZGlzIGNvbm5lY3Rpb24gZXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNsaWVudC5vbigncmVhZHknLCAoKSA9PiB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ1JlZGlzIGNsaWVudCByZWFkeScpO1xuICAgICAgICB0aGlzLnN0YXJ0TWVtb3J5TW9uaXRvcmluZygpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY2xpZW50Lm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnUmVkaXMgY29ubmVjdGlvbiBjbG9zZWQnKTtcbiAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0b3BNZW1vcnlNb25pdG9yaW5nKCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gV2FpdCBmb3IgY29ubmVjdGlvblxuICAgICAgYXdhaXQgdGhpcy5jbGllbnQucGluZygpO1xuXG4gICAgICByZXR1cm4gdGhpcy5jbGllbnQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gY29ubmVjdCB0byBSZWRpczonLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRpc2Nvbm5lY3QoKSB7XG4gICAgaWYgKHRoaXMuY2xpZW50KSB7XG4gICAgICB0aGlzLnN0b3BNZW1vcnlNb25pdG9yaW5nKCk7XG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5xdWl0KCk7XG4gICAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCdSZWRpcyBjb25uZWN0aW9uIGNsb3NlZCcpO1xuICAgIH1cbiAgfVxuXG4gIGdldENsaWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnQ7XG4gIH1cblxuICBpc0NsaWVudFJlYWR5KCkge1xuICAgIHJldHVybiB0aGlzLmNsaWVudCAmJiB0aGlzLmlzQ29ubmVjdGVkO1xuICB9XG5cbiAgc3RhcnRNZW1vcnlNb25pdG9yaW5nKCkge1xuICAgIGlmICghY29uZmlnLnJlZGlzLm1lbW9yeU1vbml0b3JpbmcuZW5hYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMubWVtb3J5Q2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghdGhpcy5pc0NsaWVudFJlYWR5KCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtZW1vcnlJbmZvID0gYXdhaXQgdGhpcy5jbGllbnQuaW5mbygnbWVtb3J5Jyk7XG4gICAgICAgIGNvbnN0IHVzZWRNZW1vcnkgPSBwYXJzZUludChtZW1vcnlJbmZvLnNwbGl0KCdcXG4nKVxuICAgICAgICAgIC5maW5kKGxpbmUgPT4gbGluZS5zdGFydHNXaXRoKCd1c2VkX21lbW9yeTonKSlcbiAgICAgICAgICAuc3BsaXQoJzonKVsxXSk7XG4gICAgICAgIGNvbnN0IG1heE1lbW9yeSA9IGF3YWl0IHRoaXMuY2xpZW50LmNvbmZpZygnR0VUJywgJ21heG1lbW9yeScpO1xuXG4gICAgICAgIGlmIChtYXhNZW1vcnkgJiYgbWF4TWVtb3J5WzFdICE9PSAnMCcpIHtcbiAgICAgICAgICBjb25zdCBtZW1vcnlQZXJjZW50YWdlID0gdXNlZE1lbW9yeSAvIHBhcnNlSW50KG1heE1lbW9yeVsxXSk7XG5cbiAgICAgICAgICBpZiAobWVtb3J5UGVyY2VudGFnZSA+PSBjb25maWcucmVkaXMubWVtb3J5TW9uaXRvcmluZy50aHJlc2hvbGRzLmNyaXRpY2FsKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihgUmVkaXMgbWVtb3J5IHVzYWdlIGNyaXRpY2FsOiAkeyhtZW1vcnlQZXJjZW50YWdlICogMTAwKS50b0ZpeGVkKDIpfSVgKTtcbiAgICAgICAgICAgIC8vIFRyaWdnZXIgY3JpdGljYWwgbWVtb3J5IGhhbmRsaW5nXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZU1lbW9yeVByZXNzdXJlKHRydWUpO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWVtb3J5UGVyY2VudGFnZSA+PSBjb25maWcucmVkaXMubWVtb3J5TW9uaXRvcmluZy50aHJlc2hvbGRzLndhcm5pbmcpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oYFJlZGlzIG1lbW9yeSB1c2FnZSBoaWdoOiAkeyhtZW1vcnlQZXJjZW50YWdlICogMTAwKS50b0ZpeGVkKDIpfSVgKTtcbiAgICAgICAgICAgIC8vIFRyaWdnZXIgd2FybmluZyBtZW1vcnkgaGFuZGxpbmdcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlTWVtb3J5UHJlc3N1cmUoZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0Vycm9yIG1vbml0b3JpbmcgUmVkaXMgbWVtb3J5OicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH0sIGNvbmZpZy5yZWRpcy5tZW1vcnlNb25pdG9yaW5nLmNoZWNrSW50ZXJ2YWwpO1xuICB9XG5cbiAgc3RvcE1lbW9yeU1vbml0b3JpbmcoKSB7XG4gICAgaWYgKHRoaXMubWVtb3J5Q2hlY2tJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1lbW9yeUNoZWNrSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5tZW1vcnlDaGVja0ludGVydmFsID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBoYW5kbGVNZW1vcnlQcmVzc3VyZShpc0NyaXRpY2FsKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEltcGxlbWVudCBtZW1vcnkgcHJlc3N1cmUgaGFuZGxpbmcgbG9naWNcbiAgICAgIGlmIChpc0NyaXRpY2FsKSB7XG4gICAgICAgIC8vIEFnZ3Jlc3NpdmUgY2FjaGUgY2xlYW51cFxuICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5rZXlzKGAke2NvbmZpZy5yZWRpcy5jYWNoZVByZWZpeH0qYClcbiAgICAgICAgICAudGhlbihrZXlzID0+IHtcbiAgICAgICAgICAgIGlmIChrZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LmRlbChrZXlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBFeHBpcmUgb2xkIHNlc3Npb25zXG4gICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmtleXMoYCR7Y29uZmlnLnJlZGlzLnNlc3Npb25QcmVmaXh9KmApXG4gICAgICAgICAgLnRoZW4oYXN5bmMgKGtleXMpID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgICAgICAgICAgY29uc3QgdHRsID0gYXdhaXQgdGhpcy5jbGllbnQudHRsKGtleSk7XG4gICAgICAgICAgICAgIGlmICh0dGwgPT09IC0xIHx8IHR0bCA+IDM2MDAwKSB7IC8vIFNlc3Npb25zIG9sZGVyIHRoYW4gMTAgaG91cnNcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5leHBpcmUoa2V5LCAzNjAwKTsgLy8gU2V0IHRvIDEgaG91clxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBOb3JtYWwgY2xlYW51cCAtIHJlbW92ZSBleHBpcmVkIGNhY2hlIGl0ZW1zXG4gICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmtleXMoYCR7Y29uZmlnLnJlZGlzLmNhY2hlUHJlZml4fSpgKVxuICAgICAgICAgIC50aGVuKGFzeW5jIChrZXlzKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHR0bCA9IGF3YWl0IHRoaXMuY2xpZW50LnR0bChrZXkpO1xuICAgICAgICAgICAgICBpZiAodHRsID09PSAtMikgeyAvLyBFeHBpcmVkIGtleXNcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5kZWwoa2V5KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBNZW1vcnkgcHJlc3N1cmUgaGFuZGxpbmcgY29tcGxldGVkIChjcml0aWNhbDogJHtpc0NyaXRpY2FsfSlgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0Vycm9yIGhhbmRsaW5nIG1lbW9yeSBwcmVzc3VyZTonLCBlcnJvci5tZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kcyBmb3IgY29tbW9uIFJlZGlzIG9wZXJhdGlvbnNcbiAgYXN5bmMgc2V0U2Vzc2lvbihzZXNzaW9uSWQsIGRhdGEsIHR0bCA9IGNvbmZpZy5yZWRpcy5zZXNzaW9uVFRMKSB7XG4gICAgaWYgKCF0aGlzLmlzQ2xpZW50UmVhZHkoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWRpcyBjbGllbnQgbm90IHJlYWR5Jyk7XG4gICAgfVxuICAgIGNvbnN0IGtleSA9IGAke2NvbmZpZy5yZWRpcy5zZXNzaW9uUHJlZml4fSR7c2Vzc2lvbklkfWA7XG4gICAgYXdhaXQgdGhpcy5jbGllbnQuc2V0KGtleSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksICdFWCcsIHR0bCk7XG4gIH1cblxuICBhc3luYyBnZXRTZXNzaW9uKHNlc3Npb25JZCkge1xuICAgIGlmICghdGhpcy5pc0NsaWVudFJlYWR5KCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBrZXkgPSBgJHtjb25maWcucmVkaXMuc2Vzc2lvblByZWZpeH0ke3Nlc3Npb25JZH1gO1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmNsaWVudC5nZXQoa2V5KTtcbiAgICByZXR1cm4gZGF0YSA/IEpTT04ucGFyc2UoZGF0YSkgOiBudWxsO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlU2Vzc2lvbihzZXNzaW9uSWQpIHtcbiAgICBpZiAoIXRoaXMuaXNDbGllbnRSZWFkeSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGtleSA9IGAke2NvbmZpZy5yZWRpcy5zZXNzaW9uUHJlZml4fSR7c2Vzc2lvbklkfWA7XG4gICAgYXdhaXQgdGhpcy5jbGllbnQuZGVsKGtleSk7XG4gIH1cblxuICBhc3luYyBzZXRDYWNoZShrZXksIGRhdGEsIHR0bCA9IGNvbmZpZy5yZWRpcy5jYWNoZVRUTCkge1xuICAgIGlmICghdGhpcy5pc0NsaWVudFJlYWR5KCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkaXMgY2xpZW50IG5vdCByZWFkeScpO1xuICAgIH1cbiAgICBjb25zdCBjYWNoZUtleSA9IGAke2NvbmZpZy5yZWRpcy5jYWNoZVByZWZpeH0ke2tleX1gO1xuICAgIGF3YWl0IHRoaXMuY2xpZW50LnNldChjYWNoZUtleSwgSlNPTi5zdHJpbmdpZnkoZGF0YSksICdFWCcsIHR0bCk7XG4gIH1cblxuICBhc3luYyBnZXRDYWNoZShrZXkpIHtcbiAgICBpZiAoIXRoaXMuaXNDbGllbnRSZWFkeSgpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgJHtjb25maWcucmVkaXMuY2FjaGVQcmVmaXh9JHtrZXl9YDtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0KGNhY2hlS2V5KTtcbiAgICByZXR1cm4gZGF0YSA/IEpTT04ucGFyc2UoZGF0YSkgOiBudWxsO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlQ2FjaGUoa2V5KSB7XG4gICAgaWYgKCF0aGlzLmlzQ2xpZW50UmVhZHkoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjYWNoZUtleSA9IGAke2NvbmZpZy5yZWRpcy5jYWNoZVByZWZpeH0ke2tleX1gO1xuICAgIGF3YWl0IHRoaXMuY2xpZW50LmRlbChjYWNoZUtleSk7XG4gIH1cblxuICBhc3luYyBjbGVhckNhY2hlKHBhdHRlcm4pIHtcbiAgICBpZiAoIXRoaXMuaXNDbGllbnRSZWFkeSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNhY2hlS2V5UGF0dGVybiA9IGAke2NvbmZpZy5yZWRpcy5jYWNoZVByZWZpeH0ke3BhdHRlcm59YDtcbiAgICBjb25zdCBrZXlzID0gYXdhaXQgdGhpcy5jbGllbnQua2V5cyhjYWNoZUtleVBhdHRlcm4pO1xuICAgIGlmIChrZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmRlbChrZXlzKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gRXhwb3J0IGEgc2luZ2xldG9uIGluc3RhbmNlXG5jb25zdCByZWRpc01hbmFnZXIgPSBuZXcgUmVkaXNNYW5hZ2VyKCk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICByZWRpc01hbmFnZXIsXG4gIGNsaWVudDogKCkgPT4gcmVkaXNNYW5hZ2VyLmdldENsaWVudCgpLFxuICBjb25uZWN0OiAoKSA9PiByZWRpc01hbmFnZXIuY29ubmVjdCgpLFxuICBkaXNjb25uZWN0OiAoKSA9PiByZWRpc01hbmFnZXIuZGlzY29ubmVjdCgpLFxuICBpc1JlYWR5OiAoKSA9PiByZWRpc01hbmFnZXIuaXNDbGllbnRSZWFkeSgpLFxuICAvLyBDb252ZW5pZW5jZSBleHBvcnRzIGZvciBjb21tb24gb3BlcmF0aW9uc1xuICBzZXRTZXNzaW9uOiAoc2Vzc2lvbklkLCBkYXRhLCB0dGwpID0+IHJlZGlzTWFuYWdlci5zZXRTZXNzaW9uKHNlc3Npb25JZCwgZGF0YSwgdHRsKSxcbiAgZ2V0U2Vzc2lvbjogKHNlc3Npb25JZCkgPT4gcmVkaXNNYW5hZ2VyLmdldFNlc3Npb24oc2Vzc2lvbklkKSxcbiAgZGVsZXRlU2Vzc2lvbjogKHNlc3Npb25JZCkgPT4gcmVkaXNNYW5hZ2VyLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkKSxcbiAgc2V0Q2FjaGU6IChrZXksIGRhdGEsIHR0bCkgPT4gcmVkaXNNYW5hZ2VyLnNldENhY2hlKGtleSwgZGF0YSwgdHRsKSxcbiAgZ2V0Q2FjaGU6IChrZXkpID0+IHJlZGlzTWFuYWdlci5nZXRDYWNoZShrZXkpLFxuICBkZWxldGVDYWNoZTogKGtleSkgPT4gcmVkaXNNYW5hZ2VyLmRlbGV0ZUNhY2hlKGtleSksXG4gIGNsZWFyQ2FjaGU6IChwYXR0ZXJuKSA9PiByZWRpc01hbmFnZXIuY2xlYXJDYWNoZShwYXR0ZXJuKVxufTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNoQyxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDakMsTUFBTUUsT0FBTyxHQUFHRixPQUFPLENBQUMsU0FBUyxDQUFDO0FB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