{"version":3,"names":["http","require","socketIo","express","jwt","cors","connectDB","closeDB","User","Channel","Message","SocketTestServer","constructor","port","app","server","createServer","io","origin","methods","onlineUsers","Map","voiceChannels","setupExpress","setupSocketIO","use","json","post","req","res","nickname","body","user","findOne","status","error","save","token","sign","id","_id","role","process","env","JWT_SECRET","expiresIn","message","socket","next","handshake","auth","Error","decoded","verify","findById","userId","err","on","set","room","data","trim","length","emit","code","channel","leave","get","join","joinMessage","author","text","type","to","timestamp","roomUsers","Array","from","values","filter","u","map","history","find","$or","target","sort","limit","msg","messageData","speaking","channelId","has","socketId","peerConnection","stream","voiceChannel","channelPeers","delete","size","offer","targetSocketId","fromNickname","answer","candidate","leaveMessage","findByIdAndUpdate","lastActive","Date","start","console","log","Promise","resolve","reject","timeout","setTimeout","listen","clearTimeout","assignedPort","address","stop","close","clear","getPort","module","exports"],"sources":["socket-server.test.js"],"sourcesContent":["const http = require('http');\nconst socketIo = require('socket.io');\nconst express = require('express');\nconst jwt = require('jsonwebtoken');\nconst cors = require('cors');\nconst { connectDB, closeDB } = require('../db/connection');\nconst User = require('../models/User');\nconst Channel = require('../models/Channel');\nconst Message = require('../models/Message');\n\n// Test server for Socket.IO integration tests\nclass SocketTestServer {\n  constructor(port = 0) { // Use 0 to get random available port\n    this.port = port;\n    this.app = express();\n    this.server = http.createServer(this.app);\n    this.io = socketIo(this.server, {\n      cors: {\n        origin: true,\n        methods: [\"GET\", \"POST\"]\n      }\n    });\n\n    this.onlineUsers = new Map();\n    this.voiceChannels = new Map();\n\n    this.setupExpress();\n    this.setupSocketIO();\n  }\n\n  setupExpress() {\n    this.app.use(cors());\n    this.app.use(express.json());\n\n    // Minimal auth route for getting tokens\n    this.app.post('/test-login', async (req, res) => {\n      try {\n        const { nickname } = req.body;\n        const user = await User.findOne({ nickname });\n\n        if (!user) {\n          return res.status(404).json({ error: 'User not found' });\n        }\n\n        // Set user as online for socket auth\n        user.status = 'online';\n        await user.save();\n\n        const token = jwt.sign(\n          { id: user._id, nickname: user.nickname, role: user.role },\n          process.env.JWT_SECRET,\n          { expiresIn: '24h' }\n        );\n\n        res.json({ token, user: { id: user._id, nickname: user.nickname, role: user.role } });\n      } catch (error) {\n        res.status(500).json({ error: error.message });\n      }\n    });\n  }\n\n  setupSocketIO() {\n    this.io.use(async (socket, next) => {\n      const token = socket.handshake.auth.token;\n\n      if (!token) {\n        return next(new Error('Authentication token required'));\n      }\n\n      try {\n        const decoded = jwt.verify(token, process.env.JWT_SECRET);\n        const user = await User.findById(decoded.id);\n\n        if (!user || user.status !== 'online') {\n          return next(new Error('User not found or not online'));\n        }\n\n        socket.userId = decoded.id;\n        socket.nickname = decoded.nickname;\n        socket.role = decoded.role;\n        return next();\n      } catch (err) {\n        return next(new Error('Authentication failed'));\n      }\n    });\n\n    this.io.on('connection', (socket) => {\n      // Track online user\n      this.onlineUsers.set(socket.id, {\n        userId: socket.userId,\n        nickname: socket.nickname,\n        role: socket.role,\n        room: null\n      });\n\n      socket.on('join_room', async (data) => {\n        const { room } = data;\n        if (!room || typeof room !== 'string' || room.trim().length === 0) {\n          socket.emit('error', {\n            message: 'Invalid room name',\n            code: 'INVALID_ROOM_FORMAT'\n          });\n          return;\n        }\n\n        try {\n          const channel = await Channel.findOne({ id: room });\n          if (!channel) {\n            socket.emit('error', {\n              message: `Channel '${room}' not found`,\n              code: 'CHANNEL_NOT_FOUND'\n            });\n            return;\n          }\n\n          // Leave previous room\n          if (socket.room) {\n            socket.leave(socket.room);\n            this.onlineUsers.set(socket.id, { ...this.onlineUsers.get(socket.id), room: null });\n          }\n\n          socket.room = room;\n          socket.join(socket.room);\n\n          this.onlineUsers.set(socket.id, {\n            ...this.onlineUsers.get(socket.id),\n            room: socket.room\n          });\n\n          // Send join system message\n          const joinMessage = new Message({\n            author: 'System',\n            channel: socket.room,\n            text: `${socket.nickname} joined the channel.`,\n            type: 'system'\n          });\n          await joinMessage.save();\n\n          this.io.to(socket.room).emit('message', {\n            author: joinMessage.author,\n            channel: joinMessage.channel,\n            text: joinMessage.text,\n            type: joinMessage.type,\n            timestamp: joinMessage.timestamp\n          });\n\n          // Send online users\n          const roomUsers = Array.from(this.onlineUsers.values())\n            .filter(u => u.room === socket.room)\n            .map(u => ({ nickname: u.nickname, role: u.role }));\n          this.io.to(socket.room).emit('online_users', roomUsers);\n\n          // Send message history\n          const history = await Message.find({\n            channel: socket.room,\n            $or: [\n              { type: 'public' },\n              { type: 'system' },\n              { author: socket.nickname },\n              { target: socket.nickname }\n            ]\n          })\n            .sort({ timestamp: -1 })\n            .limit(100)\n            .sort({ timestamp: 1 });\n\n          socket.emit('history', history.map(msg => ({\n            author: msg.author,\n            room: msg.channel,\n            text: msg.text,\n            type: msg.type,\n            target: msg.target,\n            timestamp: msg.timestamp\n          })));\n\n        } catch (error) {\n          socket.emit('error', { message: 'Failed to join room' });\n        }\n      });\n\n      socket.on('message', async (data) => {\n        if (!socket.room || !data.text?.trim()) return;\n\n        try {\n          const message = new Message({\n            author: socket.nickname,\n            channel: socket.room,\n            text: data.text.trim(),\n            type: 'public'\n          });\n\n          await message.save();\n\n          const messageData = {\n            author: message.author,\n            room: message.channel,\n            text: message.text,\n            timestamp: message.timestamp,\n            status: 'delivered',\n            type: message.type\n          };\n\n          this.io.to(socket.room).emit('message', messageData);\n        } catch (error) {\n          socket.emit('error', { message: 'Failed to send message' });\n        }\n      });\n\n      socket.on('speaking', (data) => {\n        socket.to(socket.room).emit('speaking', {\n          nickname: socket.nickname,\n          speaking: data.speaking\n        });\n      });\n\n      socket.on('join_voice_channel', async (data) => {\n        const { channelId } = data;\n        if (!channelId) return;\n\n        try {\n          const channel = await Channel.findOne({ id: channelId, type: 'voice' });\n          if (!channel) {\n            socket.emit('voice_error', { message: 'Voice channel not found' });\n            return;\n          }\n\n          if (!this.voiceChannels.has(channelId)) {\n            this.voiceChannels.set(channelId, new Map());\n          }\n\n          socket.to(channelId).emit('user_joined_voice', {\n            nickname: socket.nickname,\n            socketId: socket.id\n          });\n\n          socket.join(channelId);\n          this.voiceChannels.get(channelId).set(socket.id, { peerConnection: null, stream: null });\n\n          socket.voiceChannel = channelId;\n          socket.emit('voice_joined', { channelId });\n\n        } catch (error) {\n          socket.emit('voice_error', { message: 'Failed to join voice channel' });\n        }\n      });\n\n      socket.on('leave_voice_channel', () => {\n        if (!socket.voiceChannel) return;\n\n        const channelId = socket.voiceChannel;\n        const channelPeers = this.voiceChannels.get(channelId);\n\n        if (channelPeers) {\n          channelPeers.delete(socket.id);\n          if (channelPeers.size === 0) {\n            this.voiceChannels.delete(channelId);\n          }\n        }\n\n        socket.to(channelId).emit('user_left_voice', {\n          nickname: socket.nickname,\n          socketId: socket.id\n        });\n\n        socket.leave(channelId);\n        socket.voiceChannel = null;\n        socket.emit('voice_left');\n      });\n\n      // Voice signaling\n      socket.on('voice_offer', (data) => {\n        const { offer, targetSocketId } = data;\n        socket.to(targetSocketId).emit('voice_offer', {\n          offer,\n          from: socket.id,\n          fromNickname: socket.nickname\n        });\n      });\n\n      socket.on('voice_answer', (data) => {\n        const { answer, targetSocketId } = data;\n        socket.to(targetSocketId).emit('voice_answer', {\n          answer,\n          from: socket.id,\n          fromNickname: socket.nickname\n        });\n      });\n\n      socket.on('ice_candidate', (data) => {\n        const { candidate, targetSocketId } = data;\n        socket.to(targetSocketId).emit('ice_candidate', {\n          candidate,\n          from: socket.id,\n          fromNickname: socket.nickname\n        });\n      });\n\n      socket.on('disconnect', async () => {\n        // Leave voice channel if in one\n        if (socket.voiceChannel) {\n          const channelId = socket.voiceChannel;\n          const channelPeers = this.voiceChannels.get(channelId);\n\n          if (channelPeers) {\n            channelPeers.delete(socket.id);\n            if (channelPeers.size === 0) {\n              this.voiceChannels.delete(channelId);\n            }\n          }\n\n          socket.to(channelId).emit('user_left_voice', {\n            nickname: socket.nickname,\n            socketId: socket.id\n          });\n        }\n\n        if (socket.room) {\n          socket.leave(socket.room);\n\n          const leaveMessage = new Message({\n            author: 'System',\n            channel: socket.room,\n            text: `${socket.nickname} left the channel.`,\n            type: 'system'\n          });\n          await leaveMessage.save();\n\n          this.io.to(socket.room).emit('message', {\n            author: leaveMessage.author,\n            room: leaveMessage.channel,\n            text: leaveMessage.text,\n            type: leaveMessage.type,\n            timestamp: leaveMessage.timestamp\n          });\n\n          const roomUsers = Array.from(this.onlineUsers.values())\n            .filter(u => u.room === socket.room && u.userId !== socket.userId)\n            .map(u => ({ nickname: u.nickname, role: u.role }));\n          this.io.to(socket.room).emit('online_users', roomUsers);\n        }\n\n        this.onlineUsers.delete(socket.id);\n\n        if (socket.userId) {\n          await User.findByIdAndUpdate(socket.userId, {\n            status: 'offline',\n            lastActive: new Date()\n          });\n        }\n      });\n    });\n  }\n\n  async start() {\n    console.log(`Starting socket server on port ${this.port}...`);\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => {\n        reject(new Error('Server startup timeout after 10 seconds'));\n      }, 10000);\n\n      this.server.listen(this.port, (err) => {\n        clearTimeout(timeout);\n        if (err) {\n          console.error('Failed to start socket server:', err.message);\n          reject(err);\n        } else {\n          const assignedPort = this.server.address().port;\n          console.log(`Socket server successfully started on port ${assignedPort}`);\n          resolve(assignedPort);\n        }\n      });\n    });\n  }\n\n  async stop() {\n    return new Promise((resolve) => {\n      this.server.close(() => {\n        this.onlineUsers.clear();\n        this.voiceChannels.clear();\n        resolve();\n      });\n    });\n  }\n\n  getPort() {\n    return this.server.address()?.port;\n  }\n}\n\nmodule.exports = SocketTestServer;"],"mappings":"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","ignoreList":[]}